<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-82213539-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-82213539-2');
</script>
    <title>7 Object Relational Mapping (GORM) 3.1.15</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        The Grails Framework
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/upgrading.html"><strong>3</strong><span>Upgrading</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/conf.html"><strong>4</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/commandLine.html"><strong>5</strong><span>The Command Line</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/profiles.html"><strong>6</strong><span>Application Profiles</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/GORM.html"><strong>7</strong><span>Object Relational Mapping (GORM)</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/theWebLayer.html"><strong>8</strong><span>The Web Layer</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/traits.html"><strong>9</strong><span>Traits</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/webServices.html"><strong>10</strong><span>Web Services</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/async.html"><strong>11</strong><span>Asynchronous Programming</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/validation.html"><strong>12</strong><span>Validation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/services.html"><strong>13</strong><span>The Service Layer</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/staticTypeCheckingAndCompilation.html"><strong>14</strong><span>Static Type Checking And Compilation</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/testing.html"><strong>15</strong><span>Testing</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/i18n.html"><strong>16</strong><span>Internationalization</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/security.html"><strong>17</strong><span>Security</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/plugins.html"><strong>18</strong><span>Plugins</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/spring.html"><strong>19</strong><span>Grails and Spring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/hibernate.html"><strong>20</strong><span>Grails and Hibernate</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/scaffolding.html"><strong>21</strong><span>Scaffolding</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/deployment.html"><strong>22</strong><span>Deployment</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/contributing.html"><strong>23</strong><span>Contributing to Grails</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/profiles.html">&lt;&lt; <strong>6</strong><span>Application Profiles</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/theWebLayer.html"><strong>8</strong><span>The Web Layer</span> >></a></div>
                


                <div class="project">
                    <h1>7 Object Relational Mapping (GORM)</h1>

                    <p><strong>Version:</strong> 3.1.15</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#quickStartGuide"><strong>7.1</strong><span>Quick Start Guide</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#basicCRUD"><strong>7.1.1</strong><span>Basic CRUD</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#domainClasses"><strong>7.2</strong><span>Domain Modelling in GORM</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#gormAssociation"><strong>7.2.1</strong><span>Association in GORM</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#manyToOneAndOneToOne"><strong>7.2.1.1</strong><span>Many-to-one and one-to-one</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#oneToMany"><strong>7.2.1.2</strong><span>One-to-many</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#manyToMany"><strong>7.2.1.3</strong><span>Many-to-many</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#basicCollectionTypes"><strong>7.2.1.4</strong><span>Basic Collection Types</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#gormComposition"><strong>7.2.2</strong><span>Composition in GORM</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#inheritanceInGORM"><strong>7.2.3</strong><span>Inheritance in GORM</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#sets,ListsAndMaps"><strong>7.2.4</strong><span>Sets, Lists and Maps</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#persistenceBasics"><strong>7.3</strong><span>Persistence Basics</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#savingAndUpdating"><strong>7.3.1</strong><span>Saving and Updating</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#deletingObjects"><strong>7.3.2</strong><span>Deleting Objects</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#cascades"><strong>7.3.3</strong><span>Understanding Cascading Updates and Deletes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#fetching"><strong>7.3.4</strong><span>Eager and Lazy Fetching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#locking"><strong>7.3.5</strong><span>Pessimistic and Optimistic Locking</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#modificationChecking"><strong>7.3.6</strong><span>Modification Checking</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#querying"><strong>7.4</strong><span>Querying with GORM</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#finders"><strong>7.4.1</strong><span>Dynamic Finders</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#whereQueries"><strong>7.4.2</strong><span>Where Queries</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#criteria"><strong>7.4.3</strong><span>Criteria</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#detachedCriteria"><strong>7.4.4</strong><span>Detached Criteria</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#hql"><strong>7.4.5</strong><span>Hibernate Query Language (HQL)</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#advancedGORMFeatures"><strong>7.5</strong><span>Advanced GORM Features</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#eventsAutoTimestamping"><strong>7.5.1</strong><span>Events and Auto Timestamping</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#ormdsl"><strong>7.5.2</strong><span>Custom ORM Mapping</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#tableAndColumnNames"><strong>7.5.2.1</strong><span>Table and Column Names</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#caching"><strong>7.5.2.2</strong><span>Caching Strategy</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#inheritanceStrategies"><strong>7.5.2.3</strong><span>Inheritance Strategies</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#identity"><strong>7.5.2.4</strong><span>Custom Database Identity</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#compositePrimaryKeys"><strong>7.5.2.5</strong><span>Composite Primary Keys</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#databaseIndices"><strong>7.5.2.6</strong><span>Database Indices</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#optimisticLockingAndVersioning"><strong>7.5.2.7</strong><span>Optimistic Locking and Versioning</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#fetchingDSL"><strong>7.5.2.8</strong><span>Eager and Lazy Fetching</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#customCascadeBehaviour"><strong>7.5.2.9</strong><span>Custom Cascade Behaviour</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#customHibernateTypes"><strong>7.5.2.10</strong><span>Custom Hibernate Types</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#derivedProperties"><strong>7.5.2.11</strong><span>Derived Properties</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:20px"><a href="#customNamingStrategy"><strong>7.5.2.12</strong><span>Custom Naming Strategy</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#defaultSortOrder"><strong>7.5.3</strong><span>Default Sort Order</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#programmaticTransactions"><strong>7.6</strong><span>Programmatic Transactions</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#gormConstraints"><strong>7.7</strong><span>GORM and Constraints</span></a>
                    </div>
                    
                </div>
                

                
<a name="5. Object Relational Mapping (GORM)"><!-- Legacy link --></a>
<h1 id="GORM">7 Object Relational Mapping (GORM)</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Domain classes are core to any business application. They hold state about business processes and hopefully also implement behavior. They are linked together through relationships; one-to-one, one-to-many, or many-to-many.</p>
</div>
<div class="paragraph">
<p>GORM is Grails' object relational mapping (ORM) implementation. Under the hood it uses Hibernate 3 (a very popular and flexible open source ORM solution) and thanks to the dynamic nature of Groovy with its static and dynamic typing, along with the convention of Grails, there is far less configuration involved in creating Grails domain classes.</p>
</div>
<div class="paragraph">
<p>You can also write Grails domain classes in Java. See the section on Hibernate Integration for how to write domain classes in Java but still use dynamic persistent methods. Below is a preview of GORM in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="predefined-type">Book</span>.findByTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Groovy in Action</span><span class="delimiter">&quot;</span></span>)

book
  .addToAuthors(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Dierk Koenig</span><span class="delimiter">&quot;</span></span>)
  .addToAuthors(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Guillaume LaForge</span><span class="delimiter">&quot;</span></span>)
  .save()</code></pre>
</div>
</div>

<a name="5.1 Quick Start Guide"><!-- Legacy link --></a>
<h2 id="quickStartGuide">7.1 Quick Start Guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/quickStartGuide.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A domain class can be created with the <a href="../ref/Command%20Line/create-domain-class.html">create-domain-class</a> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-domain-<span class="type">class</span> <span class="class">helloworld</span>.Person</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no package is specified with the create-domain-class script, Grails automatically uses the application name as the package name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will create a class at the location <code>grails-app/domain/helloworld/Person.groovy</code> such as the one below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> helloworld

<span class="type">class</span> <span class="class">Person</span> {
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have the <code>dbCreate</code> property set to "update", "create" or "create-drop" on your <a href="conf.html#dataSource">DataSource</a>, Grails will automatically generate/modify the database tables for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can customize the class by adding properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> age
    <span class="predefined-type">Date</span> lastVisit
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have a domain class try and manipulate it with the <a href="../ref/Command%20Line/shell.html">shell</a> or <a href="../ref/Command%20Line/console.html">console</a> by typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails console</code></pre>
</div>
</div>
<div class="paragraph">
<p>This loads an interactive GUI where you can run Groovy commands with access to the Spring ApplicationContext, GORM, etc.</p>
</div>

<a name="5.1.1 Basic CRUD"><!-- Legacy link --></a>
<h2 id="basicCRUD">7.1.1 Basic CRUD</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/quickStartGuide/basicCRUD.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Try performing some basic CRUD (Create/Read/Update/Delete) operations.</p>
</div>
<div class="sect2">
<h3 id="_create">Create</h3>
<div class="paragraph">
<p>To create a domain class use Map constructor to set its properties and call <a href="../ref/Domain%20Classes/save.html">save</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>, <span class="key">age</span>: <span class="integer">40</span>, <span class="key">lastVisit</span>: <span class="keyword">new</span> <span class="predefined-type">Date</span>())
p.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../ref/Domain%20Classes/save.html">save</a> method will persist your class to the database using the underlying Hibernate ORM layer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_read">Read</h3>
<div class="paragraph">
<p>Grails transparently adds an implicit <code>id</code> property to your domain class which you can use for retrieval:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
<span class="keyword">assert</span> <span class="integer">1</span> == p.id</code></pre>
</div>
</div>
<div class="paragraph">
<p>This uses the <a href="../ref/Domain%20Classes/get.html">get</a> method that expects a database identifier to read the <code>Person</code> object back from the database.
You can also load an object in a read-only state by using the <a href="../ref/Domain%20Classes/read.html">read</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.read(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the underlying Hibernate engine will not do any dirty checking and the object will not be persisted. Note that
if you explicitly call the <a href="../ref/Domain%20Classes/save.html">save</a> method then the object is placed back into a read-write state.</p>
</div>
<div class="paragraph">
<p>In addition, you can also load a proxy for an instance by using the <a href="../ref/Domain%20Classes/load.html">load</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.load(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This incurs no database access until a method other than getId() is called. Hibernate then initializes the proxied instance, or
throws an exception if no record is found for the specified id.</p>
</div>
</div>
<div class="sect2">
<h3 id="_update">Update</h3>
<div class="paragraph">
<p>To update an instance, change some properties and then call <a href="../ref/Domain%20Classes/save.html">save</a> again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>
p.save()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delete">Delete</h3>
<div class="paragraph">
<p>To delete an instance use the <a href="../ref/Domain%20Classes/delete.html">delete</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.delete()</code></pre>
</div>
</div>
</div>

<a name="5.2 Domain Modelling in GORM"><!-- Legacy link --></a>
<h2 id="domainClasses">7.2 Domain Modelling in GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When building Grails applications you have to consider the problem domain you are trying to solve. For example if you were building an Amazon style bookstore you would be thinking about books, authors, customers and publishers to name a few.</p>
</div>
<div class="paragraph">
<p>These are modeled in GORM as Groovy classes, so a <code>Book</code> class may have a title, a release date, an ISBN number and so on. The next few sections show how to model the domain in GORM.</p>
</div>
<div class="paragraph">
<p>To create a domain class you run the <a href="../ref/Command%20Line/create-domain-class.html">create-domain-class</a> command as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-domain-class org.bookstore.Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result will be a class at <code>grails-app/domain/org/bookstore/Book.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.bookstore

<span class="type">class</span> <span class="class">Book</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This class will map automatically to a table in the database called <code>book</code> (the same name as the class). This behaviour is customizable through the <a href="GORM.html#ormdsl">ORM Domain Specific Language</a></p>
</div>
<div class="paragraph">
<p>Now that you have a domain class you can define its properties as Java types. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.bookstore

<span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
    <span class="predefined-type">Date</span> releaseDate
    <span class="predefined-type">String</span> ISBN
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each property is mapped to a column in the database, where the convention for column names is all lower case separated by underscores. For example <code>releaseDate</code> maps onto a column <code>release_date</code>. The SQL types are auto-detected from the Java types, but can be customized with <a href="validation.html#constraints">Constraints</a> or the <a href="GORM.html#ormdsl">ORM DSL</a>.</p>
</div>

<a name="5.2.1 Association in GORM"><!-- Legacy link --></a>
<h2 id="gormAssociation">7.2.1 Association in GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/gormAssociation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Relationships define how domain classes interact with each other. Unless specified explicitly at both ends, a relationship exists only in the direction it is defined.</p>
</div>

<a name="5.2.1.1 Many-to-one and one-to-one"><!-- Legacy link --></a>
<h2 id="manyToOneAndOneToOne">7.2.1.1 Many-to-one and one-to-one</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/gormAssociation/manyToOneAndOneToOne.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A many-to-one relationship is the simplest kind, and is defined with a property of the type of another domain class. Consider this example:</p>
</div>
<div class="sect2">
<h3 id="_example_a">Example A</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Face</span> {
    Nose nose
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Nose</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we have a unidirectional many-to-one relationship from <code>Face</code> to <code>Nose</code>. To make this relationship bidirectional define the other side as follows (and see the section on controlling the ends of the association just below):</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_b">Example B</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Face</span> {
    Nose nose
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Nose</span> {
    <span class="directive">static</span> belongsTo = [<span class="key">face</span>:Face]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we use the <code>belongsTo</code> setting to say that <code>Nose</code> "belongs to" <code>Face</code>. The result of this is that we can create a <code>Face</code>, attach a <code>Nose</code> instance to it and when we save or delete the <code>Face</code> instance, GORM will save or delete the <code>Nose</code>. In other words, saves and deletes will cascade from <code>Face</code> to the associated <code>Nose</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> Face(<span class="key">nose</span>:<span class="keyword">new</span> Nose()).save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above will save both face and nose. Note that the inverse <em>is not</em> true and will result in an error due to a transient <code>Face</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> Nose(<span class="key">face</span>:<span class="keyword">new</span> Face()).save() <span class="comment">// will cause an error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we delete the <code>Face</code> instance, the <code>Nose</code> will go too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> f = Face.get(<span class="integer">1</span>)
f.delete() <span class="comment">// both Face and Nose deleted</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the relationship a true one-to-one, use the <code>hasOne</code> property on the owning side, e.g. <code>Face</code>:</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_c">Example C</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Face</span> {
    <span class="directive">static</span> hasOne = [<span class="key">nose</span>:Nose]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Nose</span> {
    Face face
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that using this property puts the foreign key on the inverse table to the example A, so in this case the foreign key column is stored in the <code>nose</code> table inside a column called <code>face_id</code>. Also, <code>hasOne</code> only works with bidirectional relationships.</p>
</div>
<div class="paragraph">
<p>Finally, it&#8217;s a good idea to add a unique constraint on one side of the one-to-one relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Face</span> {
    <span class="directive">static</span> hasOne = [<span class="key">nose</span>:Nose]

    <span class="directive">static</span> constraints = {
        nose <span class="key">unique</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Nose</span> {
    Face face
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_the_ends_of_the_association">Controlling the ends of the association</h3>
<div class="paragraph">
<p>Occasionally you may find yourself with domain classes that have multiple properties of the same type. They may even be self-referential, i.e. the association property has the same type as the domain class it&#8217;s in. Such situations can cause problems because Grails may guess incorrectly the type of the association. Consider this simple class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Person parent

    <span class="directive">static</span> belongsTo = [ <span class="key">supervisor</span>: Person ]

    <span class="directive">static</span> constraints = { supervisor <span class="key">nullable</span>: <span class="predefined-constant">true</span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As far as Grails is concerned, the <code>parent</code> and <code>supervisor</code> properties are two directions of the same association. So when you set the <code>parent</code> property on a <code>Person</code> instance, Grails will automatically set the <code>supervisor</code> property on the other <code>Person</code> instance. This may be what you want, but if you look at the class, what we in fact have are two unidirectional relationships.</p>
</div>
<div class="paragraph">
<p>To guide Grails to the correct mapping, you can tell it that a particular association is unidirectional through the <code>mappedBy</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Person parent

    <span class="directive">static</span> belongsTo = [ <span class="key">supervisor</span>: Person ]

    <span class="directive">static</span> mappedBy = [ <span class="key">supervisor</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span>, <span class="key">parent</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span> ]

    <span class="directive">static</span> constraints = { supervisor <span class="key">nullable</span>: <span class="predefined-constant">true</span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also replace "none" with any property name of the target class. And of course this works for normal domain classes too, not just self-referential ones. Nor is the <code>mappedBy</code> property limited to many-to-one and one-to-one associations: it also works for one-to-many and many-to-many associations as you&#8217;ll see in the next section.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you have a property called "none" on your domain class, this approach won&#8217;t work currently! The "none" property will be treated as the reverse direction of the association (or the "back reference"). Fortunately, "none" is not a common domain class property name.
</td>
</tr>
</table>
</div>
</div>

<a name="5.2.1.2 One-to-many"><!-- Legacy link --></a>
<h2 id="oneToMany">7.2.1.2 One-to-many</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/gormAssociation/oneToMany.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A one-to-many relationship is when one class, example <code>Author</code>, has many instances of another class, example <code>Book</code>. With Grails you define such a relationship with the <code>hasMany</code> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we have a unidirectional one-to-many. Grails will, by default, map this kind of relationship with a join table.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <a href="GORM.html#ormdsl">ORM DSL</a> allows mapping unidirectional relationships using a foreign key association instead
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Grails will automatically inject a property of type <code>java.util.Set</code> into the domain class based on the <code>hasMany</code> setting. This can be used to iterate over the collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> a = Author.get(<span class="integer">1</span>)

<span class="keyword">for</span> (book <span class="keyword">in</span> a.books) {
    println book.title
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default fetch strategy used by Grails is "lazy", which means that the collection will be lazily initialized on first access. This can lead to the <a href="http://www.javalobby.org/java/forums/t20533.html">n+1 problem</a> if you are not careful.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need "eager" fetching you can use the <a href="GORM.html#ormdsl">ORM DSL</a> or specify eager fetching as part of a <a href="#querying">query</a></p>
</div>
<div class="paragraph">
<p>The default cascading behaviour is to cascade saves and updates, but not deletes unless a <code>belongsTo</code> is also specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]

    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="directive">static</span> belongsTo = [<span class="key">author</span>: Author]
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have two properties of the same type on the many side of a one-to-many you have to use <code>mappedBy</code> to specify which the collection is mapped:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    <span class="directive">static</span> hasMany = [<span class="key">flights</span>: Flight]
    <span class="directive">static</span> mappedBy = [<span class="key">flights</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">departureAirport</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Flight</span> {
    Airport departureAirport
    Airport destinationAirport
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is also true if you have multiple collections that map to different properties on the many side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    <span class="directive">static</span> hasMany = [<span class="key">outboundFlights</span>: Flight, <span class="key">inboundFlights</span>: Flight]
    <span class="directive">static</span> mappedBy = [<span class="key">outboundFlights</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">departureAirport</span><span class="delimiter">&quot;</span></span>,
                       <span class="key">inboundFlights</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">destinationAirport</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Flight</span> {
    Airport departureAirport
    Airport destinationAirport
}</code></pre>
</div>
</div>

<a name="5.2.1.3 Many-to-many"><!-- Legacy link --></a>
<h2 id="manyToMany">7.2.1.3 Many-to-many</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/gormAssociation/manyToMany.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails supports many-to-many relationships by defining a <code>hasMany</code> on both sides of the relationship and having a <code>belongsTo</code> on the owned side of the relationship:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="directive">static</span> belongsTo = Author
    <span class="directive">static</span> hasMany = [<span class="key">authors</span>:Author]
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="directive">static</span> hasMany = [<span class="key">books</span>:<span class="predefined-type">Book</span>]
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails maps a many-to-many using a join table at the database level. The owning side of the relationship, in this case <code>Author</code>, takes responsibility for persisting the relationship and is the only side that can cascade saves across.</p>
</div>
<div class="paragraph">
<p>For example this will work and cascade saves:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> Author(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>)
        .addToBooks(<span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>))
        .addToBooks(<span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Shining</span><span class="delimiter">&quot;</span></span>))
        .save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However this will only save the <code>Book</code> and not the authors!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Groovy in Action</span><span class="delimiter">&quot;</span></span>)
        .addToAuthors(<span class="keyword">new</span> Author(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Dierk Koenig</span><span class="delimiter">&quot;</span></span>))
        .addToAuthors(<span class="keyword">new</span> Author(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Guillaume Laforge</span><span class="delimiter">&quot;</span></span>))
        .save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the expected behaviour as, just like Hibernate, only one side of a many-to-many can take responsibility for managing the relationship.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Grails' <a href="scaffolding.html">scaffolding</a> feature <strong>does not</strong> currently support many-to-many relationship and hence you must write the code to manage the relationship yourself
</td>
</tr>
</table>
</div>

<a name="5.2.1.4 Basic Collection Types"><!-- Legacy link --></a>
<h2 id="basicCollectionTypes">7.2.1.4 Basic Collection Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/gormAssociation/basicCollectionTypes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As well as associations between different domain classes, GORM also supports mapping of basic collection types.
For example, the following class creates a <code>nicknames</code> association that is a <code>Set</code> of <code>String</code> instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">static</span> hasMany = [<span class="key">nicknames</span>: <span class="predefined-type">String</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>GORM will map an association like the above using a join table. You can alter various aspects of how the join table is mapped using the <code>joinTable</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="directive">static</span> hasMany = [<span class="key">nicknames</span>: <span class="predefined-type">String</span>]

    <span class="directive">static</span> mapping = {
       nicknames <span class="key">joinTable</span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">bunch_o_nicknames</span><span class="delimiter">'</span></span>,
                           <span class="key">key</span>: <span class="string"><span class="delimiter">'</span><span class="content">person_id</span><span class="delimiter">'</span></span>,
                           <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">nickname</span><span class="delimiter">'</span></span>,
                           <span class="key">type</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above will map to a table that looks like the following:</p>
</div>
<div class="paragraph">
<p><strong>bunch_o_nicknames Table</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">---------------------------------------------
| person_id         |     nickname          |
---------------------------------------------
|   <span class="integer">1</span>               |      Fred             |
---------------------------------------------</code></pre>
</div>
</div>

<a name="5.2.2 Composition in GORM"><!-- Legacy link --></a>
<h2 id="gormComposition">7.2.2 Composition in GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/gormComposition.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As well as <a href="#gormAssociation">association</a>, Grails supports the notion of composition. In this case instead of mapping classes onto separate tables a class can be "embedded" within the current table. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    Address homeAddress
    Address workAddress
    <span class="directive">static</span> embedded = [<span class="string"><span class="delimiter">'</span><span class="content">homeAddress</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">workAddress</span><span class="delimiter">'</span></span>]
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> number
    <span class="predefined-type">String</span> code
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting mapping would looking like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/5.2.2-composition.jpg" alt="5.2.2 composition">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you define the <code>Address</code> class in a separate Groovy file in the <code>grails-app/domain</code> directory you will also get an <code>address</code> table. If you don&#8217;t want this to happen use Groovy&#8217;s ability to define multiple classes per file and include the <code>Address</code> class below the <code>Person</code> class in the <code>grails-app/domain/Person.groovy</code> file
</td>
</tr>
</table>
</div>

<a name="5.2.3 Inheritance in GORM"><!-- Legacy link --></a>
<h2 id="inheritanceInGORM">7.2.3 Inheritance in GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/inheritanceInGORM.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>GORM supports inheritance both from abstract base classes and concrete persistent GORM entities. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Content</span> {
     <span class="predefined-type">String</span> author
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BlogEntry</span> <span class="directive">extends</span> Content {
    <span class="predefined-type">URL</span> url
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> <span class="directive">extends</span> Content {
    <span class="predefined-type">String</span> ISBN
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">PodCast</span> <span class="directive">extends</span> Content {
    <span class="type">byte</span><span class="type">[]</span> audioStream
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example we have a parent <code>Content</code> class and then various child classes with more specific behaviour.</p>
</div>
<div class="sect2">
<h3 id="_considerations">Considerations</h3>
<div class="paragraph">
<p>At the database level Grails by default uses table-per-hierarchy mapping with a discriminator column called <code>class</code> so the parent class (<code>Content</code>) and its subclasses (<code>BlogEntry</code>, <code>Book</code> etc.), share the <strong>same</strong> table.</p>
</div>
<div class="paragraph">
<p>Table-per-hierarchy mapping has a down side in that you <strong>cannot</strong> have non-nullable properties with inheritance mapping. An alternative is to use table-per-subclass which can be enabled with the <a href="GORM.html#ormdsl">ORM DSL</a></p>
</div>
<div class="paragraph">
<p>However, excessive use of inheritance and table-per-subclass can result in poor query performance due to the use of outer join queries. In general our advice is if you&#8217;re going to use inheritance, don&#8217;t abuse it and don&#8217;t make your inheritance hierarchy too deep.</p>
</div>
</div>
<div class="sect2">
<h3 id="_polymorphic_queries">Polymorphic Queries</h3>
<div class="paragraph">
<p>The upshot of inheritance is that you get the ability to polymorphically query. For example using the <a href="../ref/Domain%20Classes/list.html">list</a> method on the <code>Content</code> super class will return all subclasses of <code>Content</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> content = Content.list() <span class="comment">// list all blog entries, books and podcasts</span>
content = Content.findAllByAuthor(<span class="string"><span class="delimiter">'</span><span class="content">Joe Bloggs</span><span class="delimiter">'</span></span>) <span class="comment">// find all by author</span>

<span class="keyword">def</span> podCasts = PodCast.list() <span class="comment">// list only podcasts</span></code></pre>
</div>
</div>
</div>

<a name="5.2.4 Sets, Lists and Maps"><!-- Legacy link --></a>
<h2 id="sets,ListsAndMaps">7.2.4 Sets, Lists and Maps</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/domainClasses/sets,ListsAndMaps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_sets_of_objects">Sets of Objects</h3>
<div class="paragraph">
<p>By default when you define a relationship with GORM it is a <code>java.util.Set</code> which is an unordered collection that cannot contain duplicates. In other words when you have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The books property that GORM injects is a <code>java.util.Set</code>. Sets guarantee uniqueness but not order, which may not be what you want. To have custom ordering you configure the Set as a <code>SortedSet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">SortedSet</span> books

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case a <code>java.util.SortedSet</code> implementation is used which means you must implement <code>java.lang.Comparable</code> in your Book class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> <span class="directive">implements</span> <span class="predefined-type">Comparable</span> {

    <span class="predefined-type">String</span> title
    <span class="predefined-type">Date</span> releaseDate = <span class="keyword">new</span> <span class="predefined-type">Date</span>()

    <span class="type">int</span> compareTo(obj) {
        releaseDate.compareTo(obj.releaseDate)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of the above class is that the Book instances in the books collection of the Author class will be ordered by their release date.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lists_of_objects">Lists of Objects</h3>
<div class="paragraph">
<p>To keep objects in the order which they were added and to be able to reference them by index like an array you can define your collection type as a <code>List</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

    <span class="predefined-type">List</span> books

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case when you add new elements to the books collection the order is retained in a sequential list indexed from 0 so you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">author.books[<span class="integer">0</span>] <span class="comment">// get the first book</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The way this works at the database level is Hibernate creates a <code>books_idx</code> column where it saves the index of the elements in the collection to retain this order at the database level.</p>
</div>
<div class="paragraph">
<p>When using a <code>List</code>, elements must be added to the collection before being saved, otherwise Hibernate will throw an exception (<code>org.hibernate.HibernateException</code>: null index column for collection):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// This won't work!</span>
<span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Shining</span><span class="delimiter">'</span></span>)
book.save()
author.addToBooks(book)

<span class="comment">// Do it this way instead.</span>
<span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Misery</span><span class="delimiter">'</span></span>)
author.addToBooks(book)
author.save()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bags_of_objects">Bags of Objects</h3>
<div class="paragraph">
<p>If ordering and uniqueness aren&#8217;t a concern (or if you manage these explicitly) then you can use the Hibernate <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/collections.html">Bag</a> type to represent mapped collections.</p>
</div>
<div class="paragraph">
<p>The only change required for this is to define the collection type as a <code>Collection</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {

   <span class="predefined-type">Collection</span> books

   <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since uniqueness and order aren&#8217;t managed by Hibernate, adding to or removing from collections mapped as a Bag don&#8217;t trigger a load of all existing instances from the database, so this approach will perform better and require less memory than using a <code>Set</code> or a <code>List</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maps_of_objects">Maps of Objects</h3>
<div class="paragraph">
<p>If you want a simple map of string/value pairs GORM can map this with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="predefined-type">Map</span> books <span class="comment">// map of ISBN:book names</span>
}

<span class="keyword">def</span> a = <span class="keyword">new</span> Author()
a.books = [<span class="string"><span class="delimiter">&quot;</span><span class="content">Grails[1590597583] Book</span><span class="delimiter">&quot;</span></span>]
a.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the key and value of the map MUST be strings.</p>
</div>
<div class="paragraph">
<p>If you want a Map of objects then you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {

    <span class="predefined-type">Map</span> authors

    <span class="directive">static</span> hasMany = [<span class="key">authors</span>: Author]
}

<span class="keyword">def</span> a = <span class="keyword">new</span> Author(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>()
book.authors = [<span class="key">stephen</span>:a]
book.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The static <code>hasMany</code> property defines the type of the elements within the Map. The keys for the map <strong>must</strong> be strings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_note_on_collection_types_and_performance">A Note on Collection Types and Performance</h3>
<div class="paragraph">
<p>The Java <code>Set</code> type doesn&#8217;t allow duplicates. To ensure uniqueness when adding an entry to a <code>Set</code> association Hibernate has to load the entire associations from the database. If you have a large numbers of entries in the association this can be costly in terms of performance.</p>
</div>
<div class="paragraph">
<p>The same behavior is required for <code>List</code> types, since Hibernate needs to load the entire association to maintain order. Therefore it is recommended that if you anticipate a large numbers of records in the association that you make the association bidirectional so that the link can be created on the inverse side. For example consider the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">New Grails Book</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> author = Author.get(<span class="integer">1</span>)
book.author = author
book.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the association link is being created by the child (Book) and hence it is not necessary to manipulate the collection directly resulting in fewer queries and more efficient code. Given an <code>Author</code> with a large number of associated <code>Book</code> instances if you were to write code like the following you would see an impact on performance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">New Grails Book</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> author = Author.get(<span class="integer">1</span>)
author.addToBooks(book)
author.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also model the collection as a Hibernate Bag as described above.</p>
</div>
</div>

<a name="5.3 Persistence Basics"><!-- Legacy link --></a>
<h2 id="persistenceBasics">7.3 Persistence Basics</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A key thing to remember about Grails is that under the surface Grails is using <a href="http://www.hibernate.org/">Hibernate</a> for persistence. If you are coming from a background of using <a href="http://wiki.rubyonrails.org/rails/pages/ActiveRecord">ActiveRecord</a> or <a href="http://www.mybatis.org/">iBatis/MyBatis</a>, Hibernate&#8217;s "session" model may feel a little strange.</p>
</div>
<div class="paragraph">
<p>Grails automatically binds a Hibernate session to the currently executing request. This lets you use the <a href="../ref/Domain%20Classes/save.html">save</a> and <a href="../ref/Domain%20Classes/delete.html">delete</a> methods as well as other GORM methods transparently.</p>
</div>
<div class="sect2">
<h3 id="_transactional_write_behind">Transactional Write-Behind</h3>
<div class="paragraph">
<p>A useful feature of Hibernate over direct JDBC calls and even other frameworks is that when you call <a href="../ref/Domain%20Classes/save.html">save</a> or <a href="../ref/Domain%20Classes/delete.html">delete</a> it does not necessarily perform any SQL operations <strong>at that point</strong>. Hibernate batches up SQL statements and executes them as late as possible, often at the end of the request when flushing and closing the session. This is typically done for you automatically by Grails, which manages your Hibernate session.</p>
</div>
<div class="paragraph">
<p>Hibernate caches database updates where possible, only actually pushing the changes when it knows that a flush is required, or when a flush is triggered programmatically. One common case where Hibernate will flush cached updates is when performing queries since the cached information might be included in the query results. But as long as you&#8217;re doing non-conflicting saves, updates, and deletes, they&#8217;ll be batched until the session is flushed. This can be a significant performance boost for applications that do a lot of database writes.</p>
</div>
<div class="paragraph">
<p>Note that flushing is not the same as committing a transaction. If your actions are performed in the context of a transaction, flushing will execute SQL updates but the database will save the changes in its transaction queue and only finalize the updates when the transaction commits.</p>
</div>
</div>

<a name="5.3.1 Saving and Updating"><!-- Legacy link --></a>
<h2 id="savingAndUpdating">7.3.1 Saving and Updating</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics/savingAndUpdating.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>An example of using the <a href="../ref/Domain%20Classes/save.html">save</a> method can be seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This save will be not be pushed to the database immediately - it will be pushed when the next flush occurs. But there are occasions when you want to control when those statements are executed or, in Hibernate terminology, when the session is "flushed". To do so you can use the flush argument to the save method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this case <em>all</em> pending SQL statements including previous saves, deletes, etc. will be synchronized with the database. This also lets you catch any exceptions, which is typically useful in highly concurrent scenarios involving <a href="#locking">optimistic locking</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
<span class="keyword">try</span> {
    p.save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
}
<span class="keyword">catch</span> (org.springframework.dao.DataIntegrityViolationException e) {
    <span class="comment">// deal with exception</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another thing to bear in mind is that Grails <a href="#validation">validates</a> a domain instance every time you save it. If that validation fails the domain instance will <em>not</em> be persisted to the database. By default, <code>save()</code> will simply return <code>null</code> in this case, but if you would prefer it to throw an exception you can use the <code>failOnError</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
<span class="keyword">try</span> {
    p.save(<span class="key">failOnError</span>: <span class="predefined-constant">true</span>)
}
<span class="keyword">catch</span> (ValidationException e) {
    <span class="comment">// deal with exception</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can even change the default behaviour with a setting in <code>application.groovy</code>, as described in the <a href="conf.html#configGORM">section on configuration</a>. Just remember that when you are saving domain instances that have been bound with data provided by the user, the likelihood of validation exceptions is quite high and you won&#8217;t want those exceptions propagating to the end user.</p>
</div>
<div class="paragraph">
<p>You can find out more about the subtleties of saving data in <a href="http://blog.springsource.com/2010/06/23/gorm-gotchas-part-1/">this article</a> - a must read!</p>
</div>

<a name="5.3.2 Deleting Objects"><!-- Legacy link --></a>
<h2 id="deletingObjects">7.3.2 Deleting Objects</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics/deletingObjects.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>An example of the <a href="../ref/Domain%20Classes/delete.html">delete</a> method can be seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.delete()</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with saves, Hibernate will use transactional write-behind to perform the delete; to perform the delete in-place you can use the <code>flush</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.delete(<span class="key">flush</span>: <span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>flush</code> argument lets you catch any errors that occur during a delete. A common error that may occur is if you violate a database constraint, although this is normally down to a programming or schema error. The following example shows how to catch a <code>DataIntegrityViolationException</code> that is thrown when you violate the database constraints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)

<span class="keyword">try</span> {
    p.delete(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
}
<span class="keyword">catch</span> (org.springframework.dao.DataIntegrityViolationException e) {
    flash.message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Could not delete person </span><span class="inline"><span class="inline-delimiter">${</span>p.name<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>, <span class="key">id</span>: p.id)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Grails does not supply a <code>deleteAll</code> method as deleting data is discouraged and can often be avoided through boolean flags/logic.</p>
</div>
<div class="paragraph">
<p>If you really need to batch delete data you can use the <a href="../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a> method to do batch DML statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Customer.executeUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">delete Customer c where c.name = :oldName</span><span class="delimiter">&quot;</span></span>,
                       [<span class="key">oldName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>

<a name="5.3.3 Understanding Cascading Updates and Deletes"><!-- Legacy link --></a>
<h2 id="cascades">7.3.3 Understanding Cascading Updates and Deletes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics/cascades.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is critical that you understand how cascading updates and deletes work when using GORM. The key part to remember is the <code>belongsTo</code> setting which controls which class "owns" a relationship.</p>
</div>
<div class="paragraph">
<p>Whether it is a one-to-one, one-to-many or many-to-many, defining <code>belongsTo</code> will result in updates cascading from the owning class to its dependant (the other side of the relationship), and for many-/one-to-one and one-to-many relationships deletes will also cascade.</p>
</div>
<div class="paragraph">
<p>If you <em>do not</em> define <code>belongsTo</code> then no cascades will happen and you will have to manually save each object (except in the case of the one-to-many, in which case saves will cascade automatically if a new instance is in a <code>hasMany</code> collection).</p>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">flights</span>: Flight]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Flight</span> {
    <span class="predefined-type">String</span> number
    <span class="directive">static</span> belongsTo = [<span class="key">airport</span>: Airport]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If I now create an <code>Airport</code> and add some Flights to it I can save the <code>Airport</code> and have the updates cascaded down to each flight, hence saving the whole object graph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">new</span> Airport(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Gatwick</span><span class="delimiter">&quot;</span></span>)
        .addToFlights(<span class="keyword">new</span> Flight(<span class="key">number</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BA3430</span><span class="delimiter">&quot;</span></span>))
        .addToFlights(<span class="keyword">new</span> Flight(<span class="key">number</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EZ0938</span><span class="delimiter">&quot;</span></span>))
        .save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Conversely if I later delete the <code>Airport</code> all <code>Flight</code> instances associated with it will also be deleted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Gatwick</span><span class="delimiter">&quot;</span></span>)
airport.delete()</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if I were to remove <code>belongsTo</code> then the above cascading deletion code <strong>would not work</strong>. To understand this better take a look at the summaries below that describe the default behaviour of GORM with regards to specific associations. Also read <a href="http://blog.springsource.com/2010/07/02/gorm-gotchas-part-2/">part 2</a> of the GORM Gotchas series of articles to get a deeper understanding of relationships and cascading.</p>
</div>
<div class="sect2">
<h3 id="_bidirectional_one_to_many_with_belongsto">Bidirectional one-to-many with belongsTo</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">A</span> { <span class="directive">static</span> hasMany = [<span class="key">bees</span>: B] }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">B</span> { <span class="directive">static</span> belongsTo = [<span class="key">a</span>: A] }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of a bidirectional one-to-many where the many side defines a <code>belongsTo</code> then the cascade strategy is set to "ALL" for the one side and "NONE" for the many side.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unidirectional_one_to_many">Unidirectional one-to-many</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">A</span> { <span class="directive">static</span> hasMany = [<span class="key">bees</span>: B] }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">B</span> {  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of a unidirectional one-to-many where the many side defines no belongsTo then the cascade strategy is set to "SAVE-UPDATE".</p>
</div>
</div>
<div class="sect2">
<h3 id="_bidirectional_one_to_many_no_belongsto">Bidirectional one-to-many, no belongsTo</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">A</span> { <span class="directive">static</span> hasMany = [<span class="key">bees</span>: B] }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">B</span> { A a }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of a bidirectional one-to-many where the many side does not define a <code>belongsTo</code> then the cascade strategy is set to "SAVE-UPDATE" for the one side and "NONE" for the many side.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unidirectional_one_to_one_with_belongsto">Unidirectional one-to-one with belongsTo</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">A</span> {  }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">B</span> { <span class="directive">static</span> belongsTo = [<span class="key">a</span>: A] }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of a unidirectional one-to-one association that defines a <code>belongsTo</code> then the cascade strategy is set to "ALL" for the owning side of the relationship (A&#8594;B) and "NONE" from the side that defines the <code>belongsTo</code> (B&#8594;A)</p>
</div>
<div class="paragraph">
<p>Note that if you need further control over cascading behaviour, you can use the <a href="GORM.html#ormdsl">ORM DSL</a>.</p>
</div>
</div>

<a name="5.3.4 Eager and Lazy Fetching"><!-- Legacy link --></a>
<h2 id="fetching">7.3.4 Eager and Lazy Fetching</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics/fetching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Associations in GORM are by default lazy. This is best explained by example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">flights</span>: Flight]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Flight</span> {
    <span class="predefined-type">String</span> number
    Location destination
    <span class="directive">static</span> belongsTo = [<span class="key">airport</span>: Airport]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Location</span> {
    <span class="predefined-type">String</span> city
    <span class="predefined-type">String</span> country
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the above domain classes and the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Gatwick</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">for</span> (flight <span class="keyword">in</span> airport.flights) {
    println flight.destination.city
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>GORM will execute a single SQL query to fetch the <code>Airport</code> instance, another to get its flights, and then 1 extra query for <em>each iteration</em> over the <code>flights</code> association to get the current flight&#8217;s destination. In other words you get N+1 queries (if you exclude the original one to get the airport).</p>
</div>
<div class="sect2">
<h3 id="_configuring_eager_fetching">Configuring Eager Fetching</h3>
<div class="paragraph">
<p>An alternative approach that avoids the N+1 queries is to use eager fetching, which can be specified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">flights</span>: Flight]
    <span class="directive">static</span> mapping = {
        flights <span class="key">lazy</span>: <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the <code>flights</code> association will be loaded at the same time as its <code>Airport</code> instance, although a second query will be executed to fetch the collection. You can also use <code>fetch: 'join'</code> instead of <code>lazy: false</code> , in which case GORM will only execute a single query to get the airports and their flights. This works well for single-ended associations, but you need to be careful with one-to-manys. Queries will work as you&#8217;d expect right up to the moment you add a limit to the number of results you want. At that point, you will likely end up with fewer results than you were expecting. The reason for this is quite technical but ultimately the problem arises from GORM using a left outer join.</p>
</div>
<div class="paragraph">
<p>So, the recommendation is currently to use <code>fetch: 'join'</code> for single-ended associations and <code>lazy: false</code> for one-to-manys.</p>
</div>
<div class="paragraph">
<p>Be careful how and where you use eager loading because you could load your entire database into memory with too many eager associations. You can find more information on the mapping options in the <a href="#fetchingDSL">section on the ORM DSL</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_batch_fetching">Using Batch Fetching</h3>
<div class="paragraph">
<p>Although eager fetching is appropriate for some cases, it is not always desirable. If you made everything eager you could quite possibly load your entire database into memory resulting in performance and memory problems. An alternative to eager fetching is to use batch fetching. You can configure Hibernate to lazily fetch results in "batches". For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">flights</span>: Flight]
    <span class="directive">static</span> mapping = {
        flights <span class="key">batchSize</span>: <span class="integer">10</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, due to the <code>batchSize</code> argument, when you iterate over the <code>flights</code> association, Hibernate will fetch results in batches of 10. For example if you had an <code>Airport</code> that had 30 flights, if you didn&#8217;t configure batch fetching you would get 1 query to fetch the <code>Airport</code> and then <code>30</code> queries to fetch each flight. With batch fetching you get 1 query to fetch the <code>Airport</code> and 3 queries to fetch each <code>Flight</code> in batches of 10. In other words, batch fetching is an optimization of the lazy fetching strategy. Batch fetching can also be configured at the class level as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Flight</span> {
    ...
    static mapping = {
        batchSize <span class="integer">10</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check out <a href="http://blog.springsource.com/2010/07/28/gorm-gotchas-part-3/">part 3</a> of the GORM Gotchas series for more in-depth coverage of this tricky topic.</p>
</div>
</div>

<a name="5.3.5 Pessimistic and Optimistic Locking"><!-- Legacy link --></a>
<h2 id="locking">7.3.5 Pessimistic and Optimistic Locking</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics/locking.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_optimistic_locking">Optimistic Locking</h4>
<div class="paragraph">
<p>By default GORM classes are configured for optimistic locking. Optimistic locking is a feature of Hibernate which involves storing a version value in a special <code>version</code> column in the database that is incremented after each update.</p>
</div>
<div class="paragraph">
<p>The <code>version</code> column gets read into a <code>version</code> property that contains the current versioned state of persistent instance which you can access:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)

println airport.version</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you perform updates Hibernate will automatically check the version property against the  version column in the database and if they differ will throw a <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/StaleObjectStateException.html">StaleObjectException</a>. This will roll back the transaction if one is active.</p>
</div>
<div class="paragraph">
<p>This is useful as it allows a certain level of atomicity without resorting to pessimistic locking that has an inherit performance penalty. The downside is that you have to deal with this exception if you have highly concurrent writes. This requires flushing the session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)

<span class="keyword">try</span> {
    airport.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Heathrow</span><span class="delimiter">&quot;</span></span>
    airport.save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
}
<span class="keyword">catch</span> (org.springframework.dao.OptimisticLockingFailureException e) {
    <span class="comment">// deal with exception</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The way you deal with the exception depends on the application. You could attempt a programmatic merge of the data or go back to the user and ask them to resolve the conflict.</p>
</div>
<div class="paragraph">
<p>Alternatively, if it becomes a problem you can resort to pessimistic locking.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>version</code> will only be updated after flushing the session.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_pessimistic_locking">Pessimistic Locking</h4>
<div class="paragraph">
<p>Pessimistic locking is equivalent to doing a SQL "SELECT * FOR UPDATE" statement and locking a row in the database. This has the implication that other read operations will be blocking until the lock is released.</p>
</div>
<div class="paragraph">
<p>In Grails pessimistic locking is performed on an existing instance with the <a href="../ref/Domain%20Classes/lock.html">lock</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)
airport.lock() <span class="comment">// lock for update</span>
airport.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Heathrow</span><span class="delimiter">&quot;</span></span>
airport.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails will automatically deal with releasing the lock for you once the transaction has been committed. However, in the above case what we are doing is "upgrading" from a regular SELECT to a SELECT..FOR UPDATE and another thread could still have updated the record in between the call to <code>get()</code> and the call to <code>lock()</code>.</p>
</div>
<div class="paragraph">
<p>To get around this problem you can use the static <a href="../ref/Domain%20Classes/lock.html">lock</a> method that takes an id just like <a href="../ref/Domain%20Classes/get.html">get</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.lock(<span class="integer">10</span>) <span class="comment">// lock for update</span>
airport.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Heathrow</span><span class="delimiter">&quot;</span></span>
airport.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case only SELECT..FOR UPDATE is issued.</p>
</div>
<div class="paragraph">
<p>As well as the <a href="../ref/Domain%20Classes/lock.html">lock</a> method you can also obtain a pessimistic locking using queries. For example using a dynamic finder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Heathrow</span><span class="delimiter">&quot;</span></span>, [<span class="key">lock</span>: <span class="predefined-constant">true</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or using criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.createCriteria().get {
    eq(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Heathrow</span><span class="delimiter">'</span></span>)
    lock <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>

<a name="5.3.6 Modification Checking"><!-- Legacy link --></a>
<h2 id="modificationChecking">7.3.6 Modification Checking</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/persistenceBasics/modificationChecking.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Once you have loaded and possibly modified a persistent domain class instance, it isn&#8217;t straightforward to retrieve the original values. If you try to reload the instance using <a href="../ref/Domain%20Classes/get.html">get</a> Hibernate will return the current modified instance from its Session cache. Reloading using another query would trigger a flush which could cause problems if your data isn&#8217;t ready to be flushed yet. So GORM provides some methods to retrieve the original values that Hibernate caches when it loads the instance (which it uses for dirty checking).</p>
</div>
<div class="sect3">
<h4 id="_isdirty">isDirty</h4>
<div class="paragraph">
<p>You can use the <a href="../ref/Domain%20Classes/isDirty.html">isDirty</a> method to check if any field has been modified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)
<span class="keyword">assert</span> !airport.isDirty()

airport.properties = params
<span class="keyword">if</span> (airport.isDirty()) {
   <span class="comment">// do something based on changed state</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>isDirty()</code> does not currently check collection associations, but it does check all other persistent properties and associations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also check if individual fields have been modified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)
<span class="keyword">assert</span> !airport.isDirty()

airport.properties = params
<span class="keyword">if</span> (airport.isDirty(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) {
   <span class="comment">// do something based on changed name</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getdirtypropertynames">getDirtyPropertyNames</h4>
<div class="paragraph">
<p>You can use the <a href="../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a> method to retrieve the names of modified fields; this may be empty but will not be null:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)
<span class="keyword">assert</span> !airport.isDirty()

airport.properties = params
<span class="keyword">def</span> modifiedFieldNames = airport.getDirtyPropertyNames()
<span class="keyword">for</span> (fieldName <span class="keyword">in</span> modifiedFieldNames) {
   <span class="comment">// do something based on changed value</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getpersistentvalue">getPersistentValue</h4>
<div class="paragraph">
<p>You can use the <a href="../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a> method to retrieve the value of a modified field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airport = Airport.get(<span class="integer">10</span>)
<span class="keyword">assert</span> !airport.isDirty()

airport.properties = params
<span class="keyword">def</span> modifiedFieldNames = airport.getDirtyPropertyNames()
<span class="keyword">for</span> (fieldName <span class="keyword">in</span> modifiedFieldNames) {
    <span class="keyword">def</span> currentValue = airport.<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>fieldName</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> originalValue = airport.getPersistentValue(fieldName)
    <span class="keyword">if</span> (currentValue != originalValue) {
        <span class="comment">// do something based on changed value</span>
    }
}</code></pre>
</div>
</div>
</div>

<a name="5.4 Querying with GORM"><!-- Legacy link --></a>
<h2 id="querying">7.4 Querying with GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/querying.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>GORM supports a number of powerful ways to query from dynamic finders, to criteria to Hibernate&#8217;s object oriented query language HQL. Depending on the complexity of the query you have the following options in order of flexibility and power:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dynamic Finders</p>
</li>
<li>
<p>Where Queries</p>
</li>
<li>
<p>Criteria Queries</p>
</li>
<li>
<p>Hibernate Query Language (HQL)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, Groovy&#8217;s ability to manipulate collections with <a href="http://groovy-lang.org/processing-xml.html#_gpath">GPath</a> and methods like sort, findAll and so on combined with GORM results in a powerful combination.</p>
</div>
<div class="paragraph">
<p>However, let&#8217;s start with the basics.</p>
</div>
<div class="sect3">
<h4 id="_listing_instances">Listing instances</h4>
<div class="paragraph">
<p>Use the <a href="../ref/Domain%20Classes/list.html">list</a> method to obtain all instances of a given class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../ref/Domain%20Classes/list.html">list</a> method supports arguments to perform pagination:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list(<span class="key">offset</span>:<span class="integer">10</span>, <span class="key">max</span>:<span class="integer">20</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>as well as sorting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list(<span class="key">sort</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, <span class="key">order</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">asc</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>sort</code> argument is the name of the domain class property that you wish to sort on, and the <code>order</code> argument is either <code>asc</code> for *asc*ending or <code>desc</code> for *desc*ending.</p>
</div>
</div>
<div class="sect3">
<h4 id="_retrieval_by_database_identifier">Retrieval by Database  Identifier</h4>
<div class="paragraph">
<p>The second basic form of retrieval is by database identifier using the <a href="../ref/Domain%20Classes/get.html">get</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="predefined-type">Book</span>.get(<span class="integer">23</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also obtain a list of instances for a set of identifiers using <a href="../ref/Domain%20Classes/getAll.html">getAll</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.getAll(<span class="integer">23</span>, <span class="integer">93</span>, <span class="integer">81</span>)</code></pre>
</div>
</div>
</div>

<a name="5.4.1 Dynamic Finders"><!-- Legacy link --></a>
<h2 id="finders">7.4.1 Dynamic Finders</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/querying/finders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>GORM supports the concept of <strong>dynamic finders</strong>. A dynamic finder looks like a static method invocation, but the methods themselves don&#8217;t actually exist in any form at the code level.</p>
</div>
<div class="paragraph">
<p>Instead, a method is auto-magically generated using code synthesis at runtime, based on the properties of a given class. Take for example the <code>Book</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
    <span class="predefined-type">Date</span> releaseDate
    Author author
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Book</code> class has properties such as <code>title</code>, <code>releaseDate</code> and <code>author</code>. These can be used by the <a href="../ref/Domain%20Classes/findBy.html">findBy</a> and <a href="../ref/Domain%20Classes/findAllBy.html">findAllBy</a> methods in the form of "method expressions":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="predefined-type">Book</span>.findByTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>)

book = <span class="predefined-type">Book</span>.findByTitleLike(<span class="string"><span class="delimiter">&quot;</span><span class="content">Harry Pot%</span><span class="delimiter">&quot;</span></span>)

book = <span class="predefined-type">Book</span>.findByReleaseDateBetween(firstDate, secondDate)

book = <span class="predefined-type">Book</span>.findByReleaseDateGreaterThan(someDate)

book = <span class="predefined-type">Book</span>.findByTitleLikeOrReleaseDateLessThan(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Something%</span><span class="delimiter">&quot;</span></span>, someDate)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_method_expressions">Method Expressions</h4>
<div class="paragraph">
<p>A method expression in GORM is made up of the prefix such as <a href="../ref/Domain%20Classes/findBy.html">findBy</a> followed by an expression that combines one or more properties. The basic form is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Book</span>.findBy(&lt;&lt;Property&gt;&gt;&lt;&lt;<span class="predefined-type">Comparator</span>&gt;&gt;&lt;&lt;<span class="predefined-type">Boolean</span> Operator&gt;&gt;)?&lt;&lt;Property&gt;&gt;&lt;&lt;<span class="predefined-type">Comparator</span>&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The tokens marked with a '?' are optional. Each comparator changes the nature of the query. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="predefined-type">Book</span>.findByTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>)

book = <span class="predefined-type">Book</span>.findByTitleLike(<span class="string"><span class="delimiter">&quot;</span><span class="content">Harry Pot%</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the first query is equivalent to equality whilst the latter, due to the <code>Like</code> comparator, is equivalent to a SQL <code>like</code> expression.</p>
</div>
<div class="paragraph">
<p>The possible comparators include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>InList</code> - In the list of given values</p>
</li>
<li>
<p><code>LessThan</code> - less than a given value</p>
</li>
<li>
<p><code>LessThanEquals</code> - less than or equal a give value</p>
</li>
<li>
<p><code>GreaterThan</code> - greater than a given value</p>
</li>
<li>
<p><code>GreaterThanEquals</code> - greater than or equal a given value</p>
</li>
<li>
<p><code>Like</code> - Equivalent to a SQL like expression</p>
</li>
<li>
<p><code>Ilike</code> - Similar to a <code>Like</code>, except case insensitive</p>
</li>
<li>
<p><code>NotEqual</code> - Negates equality</p>
</li>
<li>
<p><code>InRange</code> - Between the <code>from</code> and <code>to</code> values of a Groovy Range</p>
</li>
<li>
<p><code>Rlike</code> - Performs a Regexp LIKE in MySQL or Oracle otherwise falls back to <code>Like</code></p>
</li>
<li>
<p><code>Between</code> - Between two values (requires two arguments)</p>
</li>
<li>
<p><code>IsNotNull</code> - Not a null value (doesn&#8217;t take an argument)</p>
</li>
<li>
<p><code>IsNull</code> - Is a null value (doesn&#8217;t take an argument)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notice that the last three require different numbers of method arguments compared to the rest, as demonstrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> now = <span class="keyword">new</span> <span class="predefined-type">Date</span>()
<span class="keyword">def</span> lastWeek = now - <span class="integer">7</span>
<span class="keyword">def</span> book = <span class="predefined-type">Book</span>.findByReleaseDateBetween(lastWeek, now)

books = <span class="predefined-type">Book</span>.findAllByReleaseDateIsNull()
books = <span class="predefined-type">Book</span>.findAllByReleaseDateIsNotNull()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_boolean_logic_and_or">Boolean logic (AND/OR)</h4>
<div class="paragraph">
<p>Method expressions can also use a boolean operator to combine two or more criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.findAllByTitleLikeAndReleaseDateGreaterThan(
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">%Java%</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>() - <span class="integer">30</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we&#8217;re using <code>And</code> in the middle of the query to make sure both conditions are satisfied, but you could equally use <code>Or</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.findAllByTitleLikeOrReleaseDateGreaterThan(
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">%Java%</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>() - <span class="integer">30</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can combine as many criteria as you like, but they must all be combined with <code>And</code> or all <code>Or</code>. If you need to combine <code>And</code> and <code>Or</code> or if the number of criteria creates a very long method name, just convert the query to a <a href="#criteria">Criteria</a> or <a href="#hql">HQL</a> query.</p>
</div>
</div>
<div class="sect3">
<h4 id="_querying_associations">Querying Associations</h4>
<div class="paragraph">
<p>Associations can also be used within queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> author = Author.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">def</span> books = author ? <span class="predefined-type">Book</span>.findAllByAuthor(author) : <span class="type">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case if the <code>Author</code> instance is not null we use it in a query to obtain all the <code>Book</code> instances for the given <code>Author</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pagination_and_sorting">Pagination and Sorting</h4>
<div class="paragraph">
<p>The same pagination and sorting parameters available on the <a href="../ref/Domain%20Classes/list.html">list</a> method can also be used with dynamic finders by supplying a map as the final parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> books = <span class="predefined-type">Book</span>.findAllByTitleLike(<span class="string"><span class="delimiter">&quot;</span><span class="content">Harry Pot%</span><span class="delimiter">&quot;</span></span>,
               [<span class="key">max</span>: <span class="integer">3</span>, <span class="key">offset</span>: <span class="integer">2</span>, <span class="key">sort</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, <span class="key">order</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">desc</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
</div>


<h2 id="whereQueries">7.4.2 Where Queries</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/querying/whereQueries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>where</code> method, introduced in Grails 2.0, builds on the support for <a href="#detachedCriteria">Detached Criteria</a> by providing an enhanced, compile-time checked query DSL for common queries. The <code>where</code> method is more flexible than dynamic finders, less verbose than criteria and provides a powerful mechanism to compose queries.</p>
</div>
<div class="sect3">
<h4 id="_basic_querying">Basic Querying</h4>
<div class="paragraph">
<p>The <code>where</code> method accepts a closure that looks very similar to Groovy&#8217;s regular collection methods. The closure should define the logical criteria in regular Groovy syntax, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
   firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span>
}
Person bart = query.find()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned object is a <code>DetachedCriteria</code> instance, which means it is not associated with any particular database connection or session. This means you can use the <code>where</code> method to define common queries at the class level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">static</span> simpsons = where {
         lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>
    }
    ...
}
...
Person.simpsons.each {
    println <span class="local-variable">it</span>.firstname
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Query execution is lazy and only happens upon usage of the <a href="#detachedCriteria">DetachedCriteria</a> instance. If you want to execute a where-style query immediately there are variations of the <code>findAll</code> and <code>find</code> methods to accomplish this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.findAll {
     lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>
}
<span class="keyword">def</span> results = Person.findAll(<span class="key">sort</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>) {
     lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>
}
Person p = Person.find { firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each Groovy operator maps onto a regular criteria method. The following table provides a map of Groovy operators to methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Criteria Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>==</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>!=</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ne</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&gt;=</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8656;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">le</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>in</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contained within the given list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>==~</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">like</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Like a given string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>=~</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ilike</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Case insensitive like</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is possible use regular Groovy comparison operators and logic to formulate complex queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    (lastName != <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span> &amp;&amp; firstName != <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>) || (firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span> &amp;&amp; age &gt; <span class="integer">9</span>)
}
<span class="keyword">def</span> results = query.list(<span class="key">sort</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy regex matching operators map onto like and ilike queries unless the expression on the right hand side is a <code>Pattern</code> object, in which case they map onto an <code>rlike</code> query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
     firstName ==~ ~<span class="regexp"><span class="delimiter">/</span><span class="content">B.+</span><span class="delimiter">/</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that <code>rlike</code> queries are only supported if the underlying database supports regular expressions
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <code>between</code> criteria query can be done by combining the <code>in</code> keyword with a range:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
     age <span class="keyword">in</span> <span class="integer">18</span>..<span class="integer">65</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, you can do <code>isNull</code> and <code>isNotNull</code> style queries by using <code>null</code> with regular comparison operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
     middleName == <span class="predefined-constant">null</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_query_composition">Query Composition</h4>
<div class="paragraph">
<p>Since the return value of the <code>where</code> method is a <a href="#detachedCriteria">DetachedCriteria</a> instance you can compose new queries from the original query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
     lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>
}
<span class="keyword">def</span> bartQuery = query.where {
     firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span>
}
Person p = bartQuery.find()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you cannot pass a closure defined as a variable into the <code>where</code> method unless it has been explicitly cast to a <code>DetachedCriteria</code> instance. In other words the following will produce an error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> callable = {
    lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>
}
<span class="keyword">def</span> query = Person.where(callable)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above must be written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.DetachedCriteria</span>

<span class="keyword">def</span> callable = {
    lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span>
} <span class="keyword">as</span> DetachedCriteria&lt;Person&gt;
<span class="keyword">def</span> query = Person.where(callable)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the closure definition is cast (using the Groovy <code>as</code> keyword) to a <a href="#detachedCriteria">DetachedCriteria</a> instance targeted at the <code>Person</code> class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conjunction_disjunction_and_negation">Conjunction, Disjunction and Negation</h4>
<div class="paragraph">
<p>As mentioned previously you can combine regular Groovy logical operators (<code>||</code> and <code>&amp;&amp;</code>) to form conjunctions and disjunctions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    (lastName != <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span> &amp;&amp; firstName != <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>) || (firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span> &amp;&amp; age &gt; <span class="integer">9</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also negate a logical comparison using <code>!</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span> &amp;&amp; !(lastName == <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_property_comparison_queries">Property Comparison Queries</h4>
<div class="paragraph">
<p>If you use a property name on both the left hand and right side of a comparison expression then the appropriate property comparison criteria is automatically used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
   firstName == lastName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table described how each comparison operator maps onto each criteria property comparison method:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Criteria Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>==</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eqProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>!=</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gtProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ltProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&gt;=</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">geProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8656;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">leProperty</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal to</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_querying_associations">Querying Associations</h4>
<div class="paragraph">
<p>Associations can be queried by using the dot operator to specify the property name of the association to be queried:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Pet.where {
    owner.firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span> || owner.firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can group multiple criterion inside a closure method call where the name of the method matches the association name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    pets { name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Jack</span><span class="delimiter">&quot;</span></span> || name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This technique can be combined with other top-level criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
     pets { name == <span class="string"><span class="delimiter">&quot;</span><span class="content">Jack</span><span class="delimiter">&quot;</span></span> } || firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Ed</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For collection associations it is possible to apply queries to the size of the collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
       pets.size() == <span class="integer">2</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table shows which operator maps onto which criteria method for each size() comparison:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Criteria Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>==</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeEq</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection size is equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>!=</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeNe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection size is not equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&gt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeGt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection size is greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection size is less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&gt;=</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeGe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection size is greater than or equal to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&#8656;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The collection size is less than or equal to</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_subqueries">Subqueries</h4>
<div class="paragraph">
<p>It is possible to execute subqueries within where queries. For example to find all the people older than the average age the following query can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">final</span> query = Person.where {
  age &gt; avg(age)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table lists the possible subqueries:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>avg</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The average of all values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>sum</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of all values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>max</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>min</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The count of all values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieves a property of the resulting entities</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can apply additional criteria to any subquery by using the <code>of</code> method and passing in a closure containing the criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
  age &gt; avg(age).of { lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span> } &amp;&amp; firstName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Homer</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>property</code> subquery returns multiple results, the criterion used compares all results. For example the following query will find all people younger than people with the surname "Simpson":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person.where {
    age &lt; property(age).of { lastName == <span class="string"><span class="delimiter">&quot;</span><span class="content">Simpson</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_more_advanced_subqueries_in_gorm">More Advanced Subqueries in GORM</h4>
<div class="paragraph">
<p>The support for subqueries has been extended. You can now use in  with nested subqueries</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.where {
    firstName <span class="keyword">in</span> where { age &lt; <span class="integer">18</span> }.firstName
}.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Criteria and where queries can be seamlessly mixed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.withCriteria {
    notIn <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, Person.where { age &lt; <span class="integer">18</span> }.firstName
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Subqueries can be used with projections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.where {
    age &gt; where { age &gt; <span class="integer">18</span> }.avg(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Correlated queries that span two domain classes can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> employees = Employee.where {
    region.continent <span class="keyword">in</span> [<span class="string"><span class="delimiter">'</span><span class="content">APAC</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EMEA</span><span class="delimiter">&quot;</span></span>]
    }.id()
    <span class="keyword">def</span> results = Sale.where {
    employee <span class="keyword">in</span> employees &amp;&amp; total &gt; <span class="integer">100000</span>
    }.employee.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>And support for aliases (cross query references) using simple variable declarations has been added to where queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Employee.where {
    <span class="keyword">def</span> em1 = Employee
    exists Sale.where {
        <span class="keyword">def</span> s1 = Sale
        <span class="keyword">def</span> em2 = employee
        <span class="keyword">return</span> em2.id == em1.id
    }.id()
}
<span class="keyword">def</span> results = query.list()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_functions">Other Functions</h4>
<div class="paragraph">
<p>There are several functions available to you within the context of a query. These are summarized in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>second</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The second of a date property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>minute</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minute of a date property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hour</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hour of a date property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>day</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The day of the month of a date property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>month</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The month of a date property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>year</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The year of a date property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>lower</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts a string property to upper case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>upper</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts a string property to lower case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>length</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The length of a string property</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>trim</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trims a string property</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently functions can only be applied to properties or associations of domain classes. You cannot, for example, use a function on a result of a subquery.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example the following query can be used to find all pet&#8217;s born in 2011:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Pet.where {
    year(birthDate) == <span class="integer">2011</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also apply functions to associations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    year(pets.birthDate) == <span class="integer">2009</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_batch_updates_and_deletes">Batch Updates and Deletes</h4>
<div class="paragraph">
<p>Since each <code>where</code> method call returns a <a href="#detachedCriteria">DetachedCriteria</a> instance, you can use <code>where</code> queries to execute batch operations such as batch updates and deletes. For example, the following query will update all people with the surname "Simpson" to have the surname "Bloggs":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    lastName == <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="type">int</span> total = query.updateAll(<span class="key">lastName</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bloggs</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
One limitation in regards to batch operations is that join queries (queries that query associations) are not allowed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To batch delete records you can use the <code>deleteAll</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> query = Person.where {
    lastName == <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="type">int</span> total = query.deleteAll()</code></pre>
</div>
</div>
</div>

<a name="5.4.2 Criteria"><!-- Legacy link --></a>
<h2 id="criteria">7.4.3 Criteria</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/querying/criteria.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Criteria is an advanced way to query that uses a Groovy builder to construct potentially complex queries. It is a much better approach than building up query strings using a <code>StringBuffer</code>.</p>
</div>
<div class="paragraph">
<p>Criteria can be used either with the <a href="../ref/Domain%20Classes/createCriteria.html">createCriteria</a> or <a href="../ref/Domain%20Classes/withCriteria.html">withCriteria</a> methods. The builder uses Hibernate&#8217;s Criteria API. The nodes on this builder map the static methods found in the <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/criterion/Restrictions.html">Restrictions</a> class of the Hibernate Criteria API. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> c = Account.createCriteria()
<span class="keyword">def</span> results = c {
    between(<span class="string"><span class="delimiter">&quot;</span><span class="content">balance</span><span class="delimiter">&quot;</span></span>, <span class="integer">500</span>, <span class="integer">1000</span>)
    eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">branch</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">London</span><span class="delimiter">&quot;</span></span>)
    or {
        like(<span class="string"><span class="delimiter">&quot;</span><span class="content">holderFirstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred%</span><span class="delimiter">&quot;</span></span>)
        like(<span class="string"><span class="delimiter">&quot;</span><span class="content">holderFirstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Barney%</span><span class="delimiter">&quot;</span></span>)
    }
    maxResults(<span class="integer">10</span>)
    order(<span class="string"><span class="delimiter">&quot;</span><span class="content">holderLastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">desc</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This criteria will select up to 10 <code>Account</code> objects in a List matching the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>balance</code> is between 500 and 1000</p>
</li>
<li>
<p><code>branch</code> is 'London'</p>
</li>
<li>
<p><code>holderFirstName</code> starts with 'Fred' or 'Barney'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results will be sorted in descending order by <code>holderLastName</code>.</p>
</div>
<div class="paragraph">
<p>If no records are found with the above criteria, an empty List is returned.</p>
</div>
<div class="sect3">
<h4 id="_conjunctions_and_disjunctions">Conjunctions and Disjunctions</h4>
<div class="paragraph">
<p>As demonstrated in the previous example you can group criteria in a logical OR using an <code>or { }</code> block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">or {
    between(<span class="string"><span class="delimiter">&quot;</span><span class="content">balance</span><span class="delimiter">&quot;</span></span>, <span class="integer">500</span>, <span class="integer">1000</span>)
    eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">branch</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">London</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This also works with logical AND:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">and {
    between(<span class="string"><span class="delimiter">&quot;</span><span class="content">balance</span><span class="delimiter">&quot;</span></span>, <span class="integer">500</span>, <span class="integer">1000</span>)
    eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">branch</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">London</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can also negate using logical NOT:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">not {
    between(<span class="string"><span class="delimiter">&quot;</span><span class="content">balance</span><span class="delimiter">&quot;</span></span>, <span class="integer">500</span>, <span class="integer">1000</span>)
    eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">branch</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">London</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All top level conditions are implied to be AND&#8217;d together.</p>
</div>
</div>
<div class="sect3">
<h4 id="_querying_associations">Querying Associations</h4>
<div class="paragraph">
<p>Associations can be queried by having a node that matches the property name. For example say the <code>Account</code> class had many <code>Transaction</code> objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Account</span> {
    ...
    static hasMany = [<span class="key">transactions</span>: Transaction]
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can query this association by using the property name <code>transactions</code> as a builder node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> c = Account.createCriteria()
<span class="keyword">def</span> now = <span class="keyword">new</span> <span class="predefined-type">Date</span>()
<span class="keyword">def</span> results = c.list {
    transactions {
        between(<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>, now - <span class="integer">10</span>, now)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code will find all the <code>Account</code> instances that have performed <code>transactions</code> within the last 10 days.
You can also nest such association queries within logical blocks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> c = Account.createCriteria()
<span class="keyword">def</span> now = <span class="keyword">new</span> <span class="predefined-type">Date</span>()
<span class="keyword">def</span> results = c.list {
    or {
        between(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>, now - <span class="integer">10</span>, now)
        transactions {
            between(<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>, now - <span class="integer">10</span>, now)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we find all accounts that have either performed transactions in the last 10 days OR have been recently created in the last 10 days.</p>
</div>
</div>
<div class="sect3">
<h4 id="_querying_with_projections">Querying with Projections</h4>
<div class="paragraph">
<p>Projections may be used to customise the results. Define a "projections" node within the criteria builder tree to use projections. There are equivalent methods within the projections node to the methods found in the Hibernate <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/criterion/Projections.html">Projections</a> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> c = Account.createCriteria()

<span class="keyword">def</span> numberOfBranches = c.get {
    projections {
        countDistinct(<span class="string"><span class="delimiter">'</span><span class="content">branch</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When multiple fields are specified in the projection, a List of values will be returned. A single value will be returned otherwise.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sql_projections">SQL Projections</h4>
<div class="paragraph">
<p>The criteria DSL provides access to Hibernate&#8217;s SQL projection API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Box is a domain class...</span>
<span class="type">class</span> <span class="class">Box</span> {
    <span class="type">int</span> width
    <span class="type">int</span> height
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Use SQL projections to retrieve the perimeter and area of all of the Box instances...</span>
<span class="keyword">def</span> c = <span class="predefined-type">Box</span>.createCriteria()

<span class="keyword">def</span> results = c.list {
    projections {
      sqlProjection <span class="string"><span class="delimiter">'</span><span class="content">(2 * (width + height)) as perimeter, (width * height) as area</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">perimeter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">area</span><span class="delimiter">'</span></span>], [INTEGER, INTEGER]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument to the <code>sqlProjection</code> method is the SQL which defines the projections.  The second argument is a list of
Strings which represent column aliases corresponding to the projected values expressed in the SQL.  The third argument
is a list of <code>org.hibernate.type.Type</code> instances which correspond to the projected values expressed in the SQL.  The API
supports all <code>org.hibernate.type.Type</code> objects but constants like INTEGER, LONG, FLOAT etc. are provided by the DSL which
correspond to all of the types defined in <code>org.hibernate.type.StandardBasicTypes</code>.</p>
</div>
<div class="paragraph">
<p>Consider that the following table represents the data in the
<code>BOX</code> table.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">width</th>
<th class="tableblock halign-left valign-top">height</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The query above would return results like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[[<span class="integer">18</span>, <span class="integer">14</span>], [<span class="integer">20</span>, <span class="integer">16</span>], [<span class="integer">22</span>, <span class="integer">18</span>], [<span class="integer">26</span>, <span class="integer">36</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the inner lists contains the 2 projected values for each <code>Box</code>, perimeter and area.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there are other references in scope wherever your criteria query is expressed that have names that conflict
with any of the type constants described above, the code in your criteria will refer to those references, not the type
constants provided by the DSL.  In the unlikely event of that happening you can disambiguate the conflict by referring
to the fully qualified Hibernate type.  For example <code>StandardBasicTypes.INTEGER</code> instead of <code>INTEGER</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If only 1 value is being projected, the alias and the type do not need to be included in a list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = c.list {
    projections {
      sqlProjection <span class="string"><span class="delimiter">'</span><span class="content">sum(width * height) as totalArea</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">totalArea</span><span class="delimiter">'</span></span>, INTEGER
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That query would return a single result with the value of 84 as the total area of all of the <code>Box</code> instances.</p>
</div>
<div class="paragraph">
<p>The DSL supports grouped projections with the <code>sqlGroupProjection</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = c.list {
    projections {
        sqlGroupProjection <span class="string"><span class="delimiter">'</span><span class="content">width, sum(height) as combinedHeightsForThisWidth</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">width</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">width</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">combinedHeightsForThisWidth</span><span class="delimiter">'</span></span>], [INTEGER, INTEGER]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument to the <code>sqlGroupProjection</code> method is the SQL which defines the projections.  The second argument represents the
group by clause that should be part of the query.  That string may be single column name or a comma separated list of column
names.  The third argument is a list of
Strings which represent column aliases corresponding to the projected values expressed in the SQL.  The fourth argument
is a list of <code>org.hibernate.type.Type</code> instances which correspond to the projected values expressed in the SQL.</p>
</div>
<div class="paragraph">
<p>The query above is projecting the combined heights of boxes grouped by width and would return results that look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[[<span class="integer">2</span>, <span class="integer">24</span>], [<span class="integer">4</span>, <span class="integer">9</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the inner lists contains 2 values.  The first value is a box width and the second value is the sum of the heights
of all of the boxes which have that width.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_sql_restrictions">Using SQL Restrictions</h4>
<div class="paragraph">
<p>You can access Hibernate&#8217;s SQL Restrictions capabilities.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> c = Person.createCriteria()

<span class="keyword">def</span> peopleWithShortFirstNames = c.list {
    sqlRestriction <span class="string"><span class="delimiter">&quot;</span><span class="content">char_length(first_name) &lt;= 4</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>SQL Restrictions may be parameterized to deal with SQL injection vulnerabilities related to dynamic restrictions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> c = Person.createCriteria()

<span class="keyword">def</span> peopleWithShortFirstNames = c.list {
    sqlRestriction <span class="string"><span class="delimiter">&quot;</span><span class="content">char_length(first_name) &lt; ? AND char_length(first_name) &gt; ?</span><span class="delimiter">&quot;</span></span>, [maxValue, minValue]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parameter to <code>sqlRestriction</code> is raw SQL. The <code>first_name</code> attribute referenced in the example refers to the persistence model, not the object model like in HQL queries. The <code>Person</code> property named <code>firstName</code> is mapped to the <code>first_name</code> column in the database and you must refer to that in the <code>sqlRestriction</code> string.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also note that the SQL used here is not necessarily portable across databases.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_scrollable_results">Using Scrollable Results</h4>
<div class="paragraph">
<p>You can use Hibernate&#8217;s <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/ScrollableResults.html">ScrollableResults</a> feature by calling the scroll method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = crit.scroll {
    maxResults(<span class="integer">10</span>)
}
<span class="keyword">def</span> f = results.first()
<span class="keyword">def</span> l = results.last()
<span class="keyword">def</span> n = results.next()
<span class="keyword">def</span> p = results.previous()

<span class="keyword">def</span> future = results.scroll(<span class="integer">10</span>)
<span class="keyword">def</span> accountNumber = results.getLong(<span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To quote the documentation of Hibernate ScrollableResults:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A result iterator that allows moving around within the results by arbitrary increments. The Query / ScrollableResults pattern is very similar to the JDBC PreparedStatement / ResultSet pattern and the semantics of methods of this interface are similar to the similarly named methods on ResultSet.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Contrary to JDBC, columns of results are numbered from zero.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_properties_in_the_criteria_instance">Setting properties in the Criteria instance</h4>
<div class="paragraph">
<p>If a node within the builder tree doesn&#8217;t match a particular criterion it will attempt to set a property on the Criteria object itself. This allows full access to all the properties in this class. This example calls <code>setMaxResults</code> and <code>setFirstResult</code> on the <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/Criteria.html">Criteria</a> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.hibernate.FetchMode</span> <span class="keyword">as</span> <span class="class">FM</span>
...
def results = c.list {
    maxResults(<span class="integer">10</span>)
    firstResult(<span class="integer">50</span>)
    fetchMode(<span class="string"><span class="delimiter">&quot;</span><span class="content">aRelationship</span><span class="delimiter">&quot;</span></span>, FM.JOIN)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_querying_with_eager_fetching">Querying with Eager Fetching</h4>
<div class="paragraph">
<p>In the section on <a href="#fetching">Eager and Lazy Fetching</a> we discussed how to declaratively specify fetching to avoid the N+1 SELECT problem. However, this can also be achieved using a criteria query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = Task.createCriteria()
<span class="keyword">def</span> tasks = criteria.list{
    eq <span class="string"><span class="delimiter">&quot;</span><span class="content">assignee.id</span><span class="delimiter">&quot;</span></span>, task.assignee.id
    join <span class="string"><span class="delimiter">'</span><span class="content">assignee</span><span class="delimiter">'</span></span>
    join <span class="string"><span class="delimiter">'</span><span class="content">project</span><span class="delimiter">'</span></span>
    order <span class="string"><span class="delimiter">'</span><span class="content">priority</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">asc</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the usage of the <code>join</code> method: it tells the criteria API to use a <code>JOIN</code> to fetch the named associations with the <code>Task</code> instances. It&#8217;s probably best not to use this for one-to-many associations though, because you will most likely end up with duplicate results. Instead, use the 'select' fetch mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.hibernate.FetchMode</span> <span class="keyword">as</span> <span class="class">FM</span>
...
def results = Airport.withCriteria {
    eq <span class="string"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EMEA</span><span class="delimiter">&quot;</span></span>
    fetchMode <span class="string"><span class="delimiter">&quot;</span><span class="content">flights</span><span class="delimiter">&quot;</span></span>, FM.SELECT
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although this approach triggers a second query to get the <code>flights</code> association, you will get reliable results  - even with the <code>maxResults</code> option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>fetchMode</code> and <code>join</code> are general settings of the query and can only be specified at the top-level, i.e. you cannot use them inside projections or association constraints.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An important point to bear in mind is that if you include associations in the query constraints, those associations will automatically be eagerly loaded. For example, in this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Airport.withCriteria {
    eq <span class="string"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EMEA</span><span class="delimiter">&quot;</span></span>
    flights {
        like <span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">BA%</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>flights</code> collection would be loaded eagerly via a join even though the fetch mode has not been explicitly set.</p>
</div>
</div>
<div class="sect3">
<h4 id="_method_reference">Method Reference</h4>
<div class="paragraph">
<p>If you invoke the builder with no method name such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">c { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build defaults to listing all the results and hence the above is equivalent to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">c.list { ... }</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>list</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the default method. It returns all matching rows.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>get</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a unique result set, i.e. just one row. The criteria has to be formed that way, that it only queries one row. This method is not to be confused with a limit to just the first row.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>scroll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a scrollable result set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>listDistinct</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If subqueries or associations are used, one may end up with the same row multiple times in the result set, this allows listing only distinct entities and is equivalent to <code>DISTINCT_ROOT_ENTITY</code> of the <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/criterion/CriteriaSpecification.html">CriteriaSpecification</a> class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the number of matching rows.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_combining_criteria">Combining Criteria</h4>
<div class="paragraph">
<p>You can combine multiple criteria closures in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> emeaCriteria = {
    eq <span class="string"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">EMEA</span><span class="delimiter">&quot;</span></span>
}

<span class="keyword">def</span> results = Airport.withCriteria {
    emeaCriteria.delegate = delegate
    emeaCriteria()
    flights {
        like <span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">BA%</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This technique requires that each criteria must refer to the same domain class (i.e. <code>Airport</code>).
A more flexible approach is to use Detached Criteria, as described in the following section.</p>
</div>
</div>


<h2 id="detachedCriteria">7.4.4 Detached Criteria</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/querying/detachedCriteria.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Detached Criteria are criteria queries that are not associated with any given database session/connection. Supported since Grails 2.0, Detached Criteria queries have many uses including allowing you to create common reusable criteria queries, execute subqueries and execute batch updates/deletes.</p>
</div>
<div class="sect3">
<h4 id="_building_detached_criteria_queries">Building Detached Criteria Queries</h4>
<div class="paragraph">
<p>The primary point of entry for using the Detached Criteria is the <code>grails.gorm.DetachedCriteria</code> class which accepts a domain class as the only argument to its constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.*</span>
...
def criteria = <span class="keyword">new</span> DetachedCriteria(Person)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have obtained a reference to a detached criteria instance you can execute <a href="#whereQueries">where</a> queries or criteria queries to build up the appropriate query. To build a normal criteria query you can use the <code>build</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that methods on the <code>DetachedCriteria</code> instance <strong>do not</strong> mutate the original object but instead return a new query. In other words, you have to use the return value of the <code>build</code> method to obtain the mutated criteria object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="keyword">def</span> bartQuery = criteria.build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Bart</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_executing_detached_criteria_queries">Executing Detached Criteria Queries</h4>
<div class="paragraph">
<p>Unlike regular criteria, Detached Criteria are lazy, in that no query is executed at the point of definition. Once a Detached Criteria query has been constructed then there are a number of useful query methods which are summarized in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>list</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List all matching entities</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>get</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return a single matching result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count all matching records</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exists</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return true if any matching records exist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deleteAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete all matching records</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>updateAll(Map)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update all matching records with the given properties</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As an example the following code will list the first 4 matching records sorted by the <code>firstName</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="keyword">def</span> results = criteria.list(<span class="key">max</span>:<span class="integer">4</span>, <span class="key">sort</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also supply additional criteria to the list method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = criteria.list(<span class="key">max</span>:<span class="integer">4</span>, <span class="key">sort</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>) {
    gt <span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">30</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve a single result you can use the <code>get</code> or <code>find</code> methods (which are synonyms):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Person p = criteria.find() <span class="comment">// or criteria.get()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DetachedCriteria</code> class itself also implements the <code>Iterable</code> interface which means that it can be treated like a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
criteria.each {
    println <span class="local-variable">it</span>.firstName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the query is only executed when the <code>each</code> method is called. The same applies to all other Groovy collection iteration methods.</p>
</div>
<div class="paragraph">
<p>You can also execute dynamic finders on <code>DetachedCriteria</code> just like on domain classes. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="keyword">def</span> bart = criteria.findByFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_detached_criteria_for_subqueries">Using Detached Criteria for Subqueries</h4>
<div class="paragraph">
<p>Within the context of a regular criteria query you can use <code>DetachedCriteria</code> to execute subquery. For example if you want to find all people who are older than the average age the following query will accomplish that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.withCriteria {
     gt <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> DetachedCriteria(Person).build {
         projections {
             avg <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>
         }
     }
     order <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that in this case the subquery class is the same as the original criteria query class (i.e. <code>Person</code>) and hence the query can be shortened to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.withCriteria {
     gt <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, {
         projections {
             avg <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>
         }
     }
     order <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the subquery class differs from the original criteria query then you will have to use the original syntax.</p>
</div>
<div class="paragraph">
<p>In the previous example the projection ensured that only a single result was returned (the average age). If your subquery returns multiple results then there are different criteria methods that need to be used to compare the result. For example to find all the people older than the ages 18 to 65 a <code>gtAll</code> query can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = Person.withCriteria {
    gtAll <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, {
        projections {
            property <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>
        }
        between <span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">18</span>, <span class="integer">65</span>
    }

    order <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table summarizes criteria methods for operating on subqueries that return multiple results:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>gtAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than all subquery results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>geAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal to all subquery results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ltAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than all subquery results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>leAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal to all subquery results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>eqAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equal to all subquery results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>neAll</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not equal to all subquery results</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_batch_operations_with_detached_criteria">Batch Operations with Detached Criteria</h4>
<div class="paragraph">
<p>The <code>DetachedCriteria</code> class can be used to execute batch operations such as batch updates and deletes. For example, the following query will update all people with the surname "Simpson" to have the surname "Bloggs":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="type">int</span> total = criteria.updateAll(<span class="key">lastName</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Bloggs</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that one limitation with regards to batch operations is that join queries (queries that query associations) are not allowed within the <code>DetachedCriteria</code> instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To batch delete records you can use the <code>deleteAll</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> criteria = <span class="keyword">new</span> DetachedCriteria(Person).build {
    eq <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Simpson</span><span class="delimiter">'</span></span>
}
<span class="type">int</span> total = criteria.deleteAll()</code></pre>
</div>
</div>
</div>

<a name="5.4.3 Hibernate Query Language (HQL)"><!-- Legacy link --></a>
<h2 id="hql">7.4.5 Hibernate Query Language (HQL)</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/querying/hql.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>GORM classes also support Hibernate&#8217;s query language HQL, a very complete reference for which can be found <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/queryhql.html">in the Hibernate documentation</a> of the Hibernate documentation.</p>
</div>
<div class="paragraph">
<p>GORM provides a number of methods that work with HQL including <a href="../ref/Domain%20Classes/find.html">find</a>, <a href="../ref/Domain%20Classes/findAll.html">findAll</a> and <a href="../ref/Domain%20Classes/executeQuery.html">executeQuery</a>. An example of a query can be seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results =
      <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where b.title like 'Lord of the%'</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_positional_and_named_parameters">Positional and Named Parameters</h4>
<div class="paragraph">
<p>In this case the value passed to the query is hard coded, however you can equally use positional parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results =
      <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where b.title like ?</span><span class="delimiter">&quot;</span></span>, [<span class="string"><span class="delimiter">&quot;</span><span class="content">The Shi%</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> author = Author.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> books = <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as book where book.author = ?</span><span class="delimiter">&quot;</span></span>,
                         &lt;&lt;author&gt;&gt;)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or even named parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results =
      <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b </span><span class="delimiter">&quot;</span></span> +
                   <span class="string"><span class="delimiter">&quot;</span><span class="content">where b.title like :search or b.author like :search</span><span class="delimiter">&quot;</span></span>,
                   [<span class="key">search</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Shi%</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> author = Author.findByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">def</span> books = <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as book where book.author = :author</span><span class="delimiter">&quot;</span></span>,
                         [<span class="key">author</span>: author])</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiline_queries">Multiline Queries</h4>
<div class="paragraph">
<p>-NOTE: -As of Grails 3.0.3, Triple-quoted Groovy multiline Strings now work properly with HQL queries.
-</p>
</div>
<div class="paragraph">
<p>Use the line continuation character to separate the query across multiple lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="char">\
</span><span class="content">from Book as b, </span><span class="char">\\</span><span class="char">\
</span><span class="content">     Author as a </span><span class="char">\\</span><span class="char">\
</span><span class="content">where b.author = a and a.surname = ?</span><span class="delimiter">&quot;</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">Smith</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results = <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
from Book as b,
     Author as a
where b.author = a and a.surname = ?&quot;, ['Smith']
</span><span class="delimiter">&quot;&quot;&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pagination_and_sorting">Pagination and Sorting</h4>
<div class="paragraph">
<p>You can also perform pagination and sorting whilst using HQL queries. To do so simply specify the pagination options as a Map at the end of the method call and include an "ORDER BY" clause in the HQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> results =
      <span class="predefined-type">Book</span>.findAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where </span><span class="delimiter">&quot;</span></span> +
                   <span class="string"><span class="delimiter">&quot;</span><span class="content">b.title like 'Lord of the%' </span><span class="delimiter">&quot;</span></span> +
                   <span class="string"><span class="delimiter">&quot;</span><span class="content">order by b.title asc</span><span class="delimiter">&quot;</span></span>,
                   [<span class="key">max</span>: <span class="integer">10</span>, <span class="key">offset</span>: <span class="integer">20</span>])</code></pre>
</div>
</div>
</div>

<a name="5.5 Advanced GORM Features"><!-- Legacy link --></a>
<h2 id="advancedGORMFeatures">7.5 Advanced GORM Features</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following sections cover more advanced usages of GORM including caching, custom mapping and events.</p>
</div>

<a name="5.5.1 Events and Auto Timestamping"><!-- Legacy link --></a>
<h2 id="eventsAutoTimestamping">7.5.1 Events and Auto Timestamping</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/eventsAutoTimestamping.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>GORM supports the registration of events as methods that get fired when certain events occurs such as deletes, inserts and updates. The following is a list of supported events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>beforeInsert</code> - Executed before an object is initially persisted to the database.  If you return false, the insert will be cancelled.</p>
</li>
<li>
<p><code>beforeUpdate</code> - Executed before an object is updated.  If you return false, the update will be cancelled.</p>
</li>
<li>
<p><code>beforeDelete</code> - Executed before an object is deleted.  If you return false, the delete will be cancelled.</p>
</li>
<li>
<p><code>beforeValidate</code> - Executed before an object is validated</p>
</li>
<li>
<p><code>afterInsert</code> - Executed after an object is persisted to the database</p>
</li>
<li>
<p><code>afterUpdate</code> - Executed after an object has been updated</p>
</li>
<li>
<p><code>afterDelete</code> - Executed after an object has been deleted</p>
</li>
<li>
<p><code>onLoad</code> - Executed when an object is loaded from the database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To add an event simply register the relevant method with your domain class.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not attempt to flush the session within an event (such as with <code>obj.save(flush:true)</code>). Since events are fired during flushing this will cause a StackOverflowError.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_event_types">Event types</h3>
<div class="sect3">
<h4 id="_the_beforeinsert_event">The beforeInsert event</h4>
<div class="paragraph">
<p>Fired before an object is saved to the database</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Date</span> NULL_DATE = <span class="keyword">new</span> <span class="predefined-type">Date</span>(<span class="integer">0</span>)

   <span class="predefined-type">String</span> firstName
   <span class="predefined-type">String</span> lastName
   <span class="predefined-type">Date</span> signupDate = NULL_DATE

   <span class="keyword">def</span> <span class="function">beforeInsert</span>() {
      <span class="keyword">if</span> (signupDate == NULL_DATE) {
         signupDate = <span class="keyword">new</span> <span class="predefined-type">Date</span>()
      }
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_beforeupdate_event">The beforeUpdate event</h4>
<div class="paragraph">
<p>Fired before an existing object is updated</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

   <span class="keyword">def</span> securityService

   <span class="predefined-type">String</span> firstName
   <span class="predefined-type">String</span> lastName
   <span class="predefined-type">String</span> lastUpdatedBy

   <span class="directive">static</span> constraints = {
      lastUpdatedBy <span class="key">nullable</span>: <span class="predefined-constant">true</span>
   }

   <span class="keyword">def</span> <span class="function">beforeUpdate</span>() {
      lastUpdatedBy = securityService.currentAuthenticatedUsername()
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_beforedelete_event">The beforeDelete event</h4>
<div class="paragraph">
<p>Fired before an object is deleted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="predefined-type">String</span> name

   <span class="keyword">def</span> <span class="function">beforeDelete</span>() {
      ActivityTrace.withNewSession {
         <span class="keyword">new</span> ActivityTrace(<span class="key">eventName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Person Deleted</span><span class="delimiter">&quot;</span></span>, <span class="key">data</span>: name).save()
      }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the usage of <code>withNewSession</code> method above. Since events are triggered whilst Hibernate is flushing using persistence methods like <code>save()</code> and <code>delete()</code> won&#8217;t result in objects being saved unless you run your operations with a new <code>Session</code>.</p>
</div>
<div class="paragraph">
<p>Fortunately the <code>withNewSession</code> method lets you share the same transactional JDBC connection even though you&#8217;re using a different underlying <code>Session</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_beforevalidate_event">The beforeValidate event</h4>
<div class="paragraph">
<p>Fired before an object is validated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="predefined-type">String</span> name

   <span class="directive">static</span> constraints = {
       name <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">45</span>
   }

   <span class="keyword">def</span> <span class="function">beforeValidate</span>() {
       name = name?.trim()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>beforeValidate</code> method is run before any validators are run.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Validation may run more often than you think. It is triggered by the <code>validate()</code> and <code>save()</code> methods as you&#8217;d expect, but it is also typically triggered just before the view is rendered as well. So when writing <code>beforeValidate()</code> implementations, make sure that they can handle being called multiple times with the same property values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GORM supports an overloaded version of <code>beforeValidate</code> which accepts a <code>List</code> parameter which may include
the names of the properties which are about to be validated.  This version of <code>beforeValidate</code> will be called
when the <code>validate</code> method has been invoked and passed a <code>List</code> of property names as an argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="predefined-type">String</span> name
   <span class="predefined-type">String</span> town
   <span class="predefined-type">Integer</span> age

   <span class="directive">static</span> constraints = {
       name <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">45</span>
       age <span class="key">range</span>: <span class="integer">4</span>..<span class="integer">99</span>
   }

   <span class="keyword">def</span> <span class="function">beforeValidate</span>(<span class="predefined-type">List</span> propertiesBeingValidated) {
      <span class="comment">// do pre validation work based on propertiesBeingValidated</span>
   }
}

<span class="keyword">def</span> p = <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Jacob Brown</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">10</span>)
p.validate([<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that when <code>validate</code> is triggered indirectly because of a call to the <code>save</code> method that
the <code>validate</code> method is being invoked with no arguments, not a <code>List</code> that includes all of
the property names.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Either or both versions of <code>beforeValidate</code> may be defined in a domain class.  GORM will
prefer the <code>List</code> version if a <code>List</code> is passed to <code>validate</code> but will fall back on the
no-arg version if the <code>List</code> version does not exist.  Likewise, GORM will prefer the
no-arg version if no arguments are passed to <code>validate</code> but will fall back on the
<code>List</code> version if the no-arg version does not exist.  In that case, <code>null</code> is passed to <code>beforeValidate</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_onload_beforeload_event">The onLoad/beforeLoad event</h4>
<div class="paragraph">
<p>Fired immediately before an object is loaded from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="predefined-type">String</span> name
   <span class="predefined-type">Date</span> dateCreated
   <span class="predefined-type">Date</span> lastUpdated

   <span class="keyword">def</span> <span class="function">onLoad</span>() {
      log.debug <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading </span><span class="inline"><span class="inline-delimiter">${</span>id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>beforeLoad()</code> is effectively a synonym for <code>onLoad()</code>, so only declare one or the other.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_afterload_event">The afterLoad event</h4>
<div class="paragraph">
<p>Fired immediately after an object is loaded from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="predefined-type">String</span> name
   <span class="predefined-type">Date</span> dateCreated
   <span class="predefined-type">Date</span> lastUpdated

   <span class="keyword">def</span> <span class="function">afterLoad</span>() {
      name = <span class="string"><span class="delimiter">&quot;</span><span class="content">I'm loaded</span><span class="delimiter">&quot;</span></span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_event_listeners">Custom Event Listeners</h4>
<div class="paragraph">
<p>As of Grails 2.0 there is a new API for plugins and applications to register and listen for persistence events. This API is not tied to Hibernate and also works for other persistence plugins such as the <a href="https://grails.org/plugins.html#plugin/mongodb">MongoDB plugin for GORM</a>.</p>
</div>
<div class="paragraph">
<p>To use this API you need to subclass <code>AbstractPersistenceEventListener</code> (in package <em>org.grails.datastore.mapping.engine.event</em>) and implement the methods <code>onPersistenceEvent</code> and <code>supportsEventType</code>. You also must provide a reference to the datastore to the listener.  The simplest possible implementation can be seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">public</span> MyPersistenceListener(<span class="directive">final</span> Datastore datastore) {
    <span class="local-variable">super</span>(datastore)
}

<span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> onPersistenceEvent(<span class="directive">final</span> AbstractPersistenceEvent event) {
    <span class="keyword">switch</span>(event.eventType) {
        <span class="keyword">case</span> <span class="key">PreInsert</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">PRE INSERT </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>
        <span class="keyword">case</span> <span class="key">PostInsert</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">POST INSERT </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>
        <span class="keyword">case</span> <span class="key">PreUpdate</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">PRE UPDATE </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="key">PostUpdate</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">POST UPDATE </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="key">PreDelete</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">PRE DELETE </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="key">PostDelete</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">POST DELETE </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="key">PreLoad</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">PRE LOAD </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="key">PostLoad</span>:
            println <span class="string"><span class="delimiter">&quot;</span><span class="content">POST LOAD </span><span class="inline"><span class="inline-delimiter">${</span>event.entityObject<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        <span class="keyword">break</span>;
    }
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">boolean</span> supportsEventType(<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> ApplicationEvent&gt; eventType) {
    <span class="keyword">return</span> <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AbstractPersistenceEvent</code> class has many subclasses (<code>PreInsertEvent</code>, <code>PostInsertEvent</code> etc.) that provide further information specific to the event. A <code>cancel()</code> method is also provided on the event which allows you to veto an insert, update or delete operation.</p>
</div>
<div class="paragraph">
<p>Once you have created your event listener you need to register it with the <code>ApplicationContext</code>. This can be done in <code>BootStrap.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> grailsApplication

<span class="keyword">def</span> init = {
    <span class="keyword">def</span> applicationContext = grailsApplication.mainContext
    applicationContext.eventTriggeringInterceptor.datastores.each { k, datastore -&gt;
        applicationContext.addApplicationListener <span class="keyword">new</span> MyPersistenceListener(datastore)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or use this in a plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> doWithApplicationContext = { applicationContext -&gt;
    grailsApplication.mainContext.eventTriggeringInterceptor.datastores.each { k, datastore -&gt;
        applicationContext.addApplicationListener <span class="keyword">new</span> MyPersistenceListener(datastore)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hibernate_events">Hibernate Events</h4>
<div class="paragraph">
<p>It is generally encouraged to use the non-Hibernate specific API described above, but if you need access to more detailed Hibernate events then you can define custom Hibernate-specific event listeners.</p>
</div>
<div class="paragraph">
<p>You can also register event handler classes in an application&#8217;s <code>grails-app/conf/spring/resources.groovy</code> or in the <code>doWithSpring</code> closure in a plugin descriptor by registering a Spring bean named <code>hibernateEventListeners</code>. This bean has one property, <code>listenerMap</code> which specifies the listeners to register for various Hibernate events.</p>
</div>
<div class="paragraph">
<p>The values of the Map are instances of classes that implement one or more Hibernate listener interfaces. You can use one class that implements all of the required interfaces, or one concrete class per interface, or any combination. The valid Map keys and corresponding interfaces are listed here:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>Interface</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto-flush</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/AutoFlushEventListener.html">AutoFlushEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">merge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/MergeEventListener.html">MergeEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PersistEventListener.html">PersistEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">create-onflush</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PersistEventListener.html">PersistEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/DeleteEventListener.html">DeleteEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dirty-check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/DirtyCheckEventListener.html">DirtyCheckEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">evict</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/EvictEventListener.html">EvictEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/FlushEventListener.html">FlushEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush-entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/FlushEntityEventListener.html">FlushEntityEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/LoadEventListener.html">LoadEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">load-collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/InitializeCollectionEventListener.html">InitializeCollectionEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/LockEventListener.html">LockEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">refresh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/RefreshEventListener.html">RefreshEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/ReplicateEventListener.html">ReplicateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">save-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/SaveOrUpdateEventListener.html">SaveOrUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/SaveOrUpdateEventListener.html">SaveOrUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/SaveOrUpdateEventListener.html">SaveOrUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreLoadEventListener.html">PreLoadEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreUpdateEventListener.html">PreUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreDeleteEventListener.html">PreDeleteEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-insert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreInsertEventListener.html">PreInsertEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-collection-recreate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreCollectionRecreateEventListener.html">PreCollectionRecreateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-collection-remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreCollectionRemoveEventListener.html">PreCollectionRemoveEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre-collection-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PreCollectionUpdateEventListener.html">PreCollectionUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostLoadEventListener.html">PostLoadEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostUpdateEventListener.html">PostUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostDeleteEventListener.html">PostDeleteEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-insert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostInsertEventListener.html">PostInsertEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-commit-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostUpdateEventListener.html">PostUpdateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-commit-delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostDeleteEventListener.html">PostDeleteEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-commit-insert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostInsertEventListener.html">PostInsertEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-collection-recreate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostCollectionRecreateEventListener.html">PostCollectionRecreateEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-collection-remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostCollectionRemoveEventListener.html">PostCollectionRemoveEventListener</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">post-collection-update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/event/PostCollectionUpdateEventListener.html">PostCollectionUpdateEventListener</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, you could register a class <code>AuditEventListener</code> which implements <code>PostInsertEventListener</code>, <code>PostUpdateEventListener</code>, and <code>PostDeleteEventListener</code> using the following in an application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {

   auditListener(AuditEventListener)

   hibernateEventListeners(HibernateEventListeners) {
      listenerMap = [<span class="string"><span class="delimiter">'</span><span class="content">post-insert</span><span class="delimiter">'</span></span>: auditListener,
                     <span class="string"><span class="delimiter">'</span><span class="content">post-update</span><span class="delimiter">'</span></span>: auditListener,
                     <span class="string"><span class="delimiter">'</span><span class="content">post-delete</span><span class="delimiter">'</span></span>: auditListener]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or use this in a plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> doWithSpring = {

   auditListener(AuditEventListener)

   hibernateEventListeners(HibernateEventListeners) {
      listenerMap = [<span class="string"><span class="delimiter">'</span><span class="content">post-insert</span><span class="delimiter">'</span></span>: auditListener,
                     <span class="string"><span class="delimiter">'</span><span class="content">post-update</span><span class="delimiter">'</span></span>: auditListener,
                     <span class="string"><span class="delimiter">'</span><span class="content">post-delete</span><span class="delimiter">'</span></span>: auditListener]
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_timestamping">Automatic timestamping</h4>
<div class="paragraph">
<p>If you define a <code>dateCreated</code> property it will be set to the current date for you when you create new instances. Likewise, if you define a <code>lastUpdated</code> property it will be automatically be updated for you when you change persistent instances.</p>
</div>
<div class="paragraph">
<p>If this is not the behaviour you want you can disable this feature with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
   <span class="predefined-type">Date</span> dateCreated
   <span class="predefined-type">Date</span> lastUpdated
   <span class="directive">static</span> mapping = {
      autoTimestamp <span class="predefined-constant">false</span>
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you have <code>nullable: false</code> constraints on either <code>dateCreated</code> or <code>lastUpdated</code>, your domain instances will fail validation - probably not what you want. Omit constraints from these properties unless you disable automatic timestamping.
</td>
</tr>
</table>
</div>
</div>
</div>

<a name="5.5.2 Custom ORM Mapping"><!-- Legacy link --></a>
<h2 id="ormdsl">7.5.2 Custom ORM Mapping</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails domain classes can be mapped onto many legacy schemas with an Object Relational Mapping DSL (domain specific language). The following sections takes you through what is possible with the ORM DSL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
None of this is necessary if you are happy to stick to the conventions defined by GORM for table names, column names and so on. You only needs this functionality if you need to tailor the way GORM maps onto legacy schemas or configures caching
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Custom mappings are defined using a static <code>mapping</code> block defined within your domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        version <span class="predefined-constant">false</span>
        autoTimestamp <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure global mappings in <code>application.groovy</code> (or an external config file) using this setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.gorm.default.mapping = {
    version <span class="predefined-constant">false</span>
    autoTimestamp <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It has the same syntax as the standard <code>mapping</code> block but it applies to all your domain classes! You can then override these defaults within the <code>mapping</code> block of a domain class.</p>
</div>

<a name="5.5.2.1 Table and Column Names"><!-- Legacy link --></a>
<h2 id="tableAndColumnNames">7.5.2.1 Table and Column Names</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/tableAndColumnNames.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_table_names">Table names</h4>
<div class="paragraph">
<p>The database table name which the class maps to can be customized using the <code>table</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the class would be mapped to a table called <code>people</code> instead of the default name of <code>person</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_column_names">Column names</h4>
<div class="paragraph">
<p>It is also possible to customize the mapping for individual columns onto the database. For example to change the name you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName

    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        firstName <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">First_Name</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>firstName</code> is a dynamic method within the <code>mapping</code> Closure that has a single Map parameter. Since its name corresponds to a domain class persistent field, the parameter values (in this case just <code>"column"</code>) are used to configure the mapping for that property.</p>
</div>
</div>
<div class="sect3">
<h4 id="_column_type">Column type</h4>
<div class="paragraph">
<p>GORM supports configuration of Hibernate types with the DSL using the type attribute. This includes specifying user types that implement the Hibernate <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/usertype/UserType.html">org.hibernate.usertype.UserType</a> interface, which allows complete customization of how a type is persisted. As an example if you had a <code>PostCodeType</code> you could use it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {

    <span class="predefined-type">String</span> number
    <span class="predefined-type">String</span> postCode

    <span class="directive">static</span> mapping = {
        postCode <span class="key">type</span>: PostCodeType
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively if you just wanted to map it to one of Hibernate&#8217;s basic types other than the default chosen by Grails you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {

    <span class="predefined-type">String</span> number
    <span class="predefined-type">String</span> postCode

    <span class="directive">static</span> mapping = {
        postCode <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">text</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This would make the <code>postCode</code> column map to the default large-text type for the database you&#8217;re using (for example TEXT or CLOB).</p>
</div>
<div class="paragraph">
<p>See the Hibernate documentation regarding <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-types-basictypes">Basic Types</a> for further information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_many_to_one_one_to_one_mappings">Many-to-One/One-to-One Mappings</h4>
<div class="paragraph">
<p>In the case of associations it is also possible to configure the foreign keys used to map associations. In the case of a many-to-one or one-to-one association this is exactly the same as any regular column. For example consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName
    Address address

    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        firstName <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">First_Name</span><span class="delimiter">'</span></span>
        address <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Person_Address_Id</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the <code>address</code> association would map to a foreign key column called <code>address_id</code>. By using the above mapping we have changed the name of the foreign key column to <code>Person_Adress_Id</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_one_to_many_mapping">One-to-Many Mapping</h4>
<div class="paragraph">
<p>With a bidirectional one-to-many you can change the foreign key column used by changing the column name on the many side of the association as per the example in the previous section on one-to-one associations. However, with unidirectional associations the foreign key needs to be specified on the association itself. For example given a unidirectional one-to-many relationship between <code>Person</code> and <code>Address</code> the following code will change the foreign key in the <code>address</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName

    <span class="directive">static</span> hasMany = [<span class="key">addresses</span>: Address]

    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        firstName <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">First_Name</span><span class="delimiter">'</span></span>
        addresses <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Person_Address_Id</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t want the column to be in the <code>address</code> table, but instead some intermediate join table you can use the <code>joinTable</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName

    <span class="directive">static</span> hasMany = [<span class="key">addresses</span>: Address]

    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        firstName <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">First_Name</span><span class="delimiter">'</span></span>
        addresses <span class="key">joinTable</span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Person_Addresses</span><span class="delimiter">'</span></span>,
                              <span class="key">key</span>: <span class="string"><span class="delimiter">'</span><span class="content">Person_Id</span><span class="delimiter">'</span></span>,
                              <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Address_Id</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_many_to_many_mapping">Many-to-Many Mapping</h4>
<div class="paragraph">
<p>Grails, by default maps a many-to-many association using a join table. For example consider this many-to-many association:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Group</span> {
    ...
    static hasMany = [<span class="key">people</span>: Person]
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static belongsTo = <span class="predefined-type">Group</span>
    <span class="directive">static</span> hasMany = [<span class="key">groups</span>: <span class="predefined-type">Group</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case Grails will create a join table called <code>group_person</code> containing foreign keys called <code>person_id</code> and <code>group_id</code> referencing the <code>person</code> and <code>group</code> tables. To change the column names you can specify a column within the mappings for each class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Group</span> {
   ...
   static mapping = {
       people <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Group_Person_Id</span><span class="delimiter">'</span></span>
   }
}
<span class="type">class</span> <span class="class">Person</span> {
   ...
   static mapping = {
       groups <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Group_Group_Id</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify the name of the join table to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Group</span> {
   ...
   static mapping = {
       people <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Group_Person_Id</span><span class="delimiter">'</span></span>,
              <span class="key">joinTable</span>: <span class="string"><span class="delimiter">'</span><span class="content">PERSON_GROUP_ASSOCIATIONS</span><span class="delimiter">'</span></span>
   }
}
<span class="type">class</span> <span class="class">Person</span> {
   ...
   static mapping = {
       groups <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Group_Group_Id</span><span class="delimiter">'</span></span>,
              <span class="key">joinTable</span>: <span class="string"><span class="delimiter">'</span><span class="content">PERSON_GROUP_ASSOCIATIONS</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
</div>

<a name="5.5.2.2 Caching Strategy"><!-- Legacy link --></a>
<h2 id="caching">7.5.2.2 Caching Strategy</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/caching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_caching">Setting up caching</h4>
<div class="paragraph">
<p><a href="http://www.hibernate.org/">Hibernate</a> features a second-level cache with a customizable cache provider. This needs to be configured in the <code>grails-app/conf/application.yml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">hibernate</span>:
  <span class="key">cache</span>:
    <span class="key">use_second_level_cache</span>: <span class="predefined-constant">true</span>
    <span class="key">provider_class</span>: net.sf.ehcache.hibernate.EhCacheProvider
    <span class="key">region</span>:
       <span class="key">factory_class</span>: org.hibernate.cache.ehcache.EhCacheRegionFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can customize any of these settings, for example to use a distributed caching mechanism.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For further reading on caching and in particular Hibernate&#8217;s second-level cache, refer to the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/performance.html#performance-cache">Hibernate documentation</a> on the subject.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_caching_instances">Caching instances</h4>
<div class="paragraph">
<p>Call the <code>cache</code> method in your mapping block to enable caching with the default settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        cache <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will configure a 'read-write' cache that includes both lazy and non-lazy properties. You can customize this further:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        cache <span class="key">usage</span>: <span class="string"><span class="delimiter">'</span><span class="content">read-only</span><span class="delimiter">'</span></span>, <span class="key">include</span>: <span class="string"><span class="delimiter">'</span><span class="content">non-lazy</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_caching_associations">Caching associations</h4>
<div class="paragraph">
<p>As well as the ability to use Hibernate&#8217;s second level cache to cache instances you can also cache collections (associations) of objects. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName

    <span class="directive">static</span> hasMany = [<span class="key">addresses</span>: Address]

    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        version <span class="predefined-constant">false</span>
        addresses <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Address</span><span class="delimiter">'</span></span>, <span class="key">cache</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> number
    <span class="predefined-type">String</span> postCode
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will enable a 'read-write' caching mechanism on the <code>addresses</code> collection. You can also use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">cache</span>: <span class="string"><span class="delimiter">'</span><span class="content">read-write</span><span class="delimiter">'</span></span> <span class="comment">// or 'read-only' or 'transactional'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to further configure the cache usage.</p>
</div>
</div>
<div class="sect3">
<h4 id="_caching_queries">Caching Queries</h4>
<div class="paragraph">
<p>You can cache queries such as dynamic finders and criteria. To do so using a dynamic finder you can pass the <code>cache</code> argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> person = Person.findByFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>, [<span class="key">cache</span>: <span class="predefined-constant">true</span>])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order for the results of the query to be cached, you must enable caching in your mapping as discussed in the previous section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also cache criteria queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> people = Person.withCriteria {
    like(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Fr%</span><span class="delimiter">'</span></span>)
    cache <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cache_usages">Cache usages</h4>
<div class="paragraph">
<p>Below is a description of the different cache settings and their usages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>read-only</code> - If your application needs to read but never modify instances of a persistent class, a read-only cache may be used.</p>
</li>
<li>
<p><code>read-write</code> - If the application needs to update data, a read-write cache might be appropriate.</p>
</li>
<li>
<p><code>nonstrict-read-write</code> - If the application only occasionally needs to update data (i.e. if it is very unlikely that two transactions would try to update the same item simultaneously) and strict transaction isolation is not required, a <code>nonstrict-read-write</code> cache might be appropriate.</p>
</li>
<li>
<p><code>transactional</code> - The <code>transactional</code> cache strategy provides support for fully transactional cache providers such as JBoss TreeCache. Such a cache may only be used in a JTA environment and you must specify <code>hibernate.transaction.manager_lookup_class</code> in the <code>grails-app/conf/application.groovy</code> file&#8217;s <code>hibernate</code> config.</p>
</li>
</ul>
</div>
</div>

<a name="5.5.2.3 Inheritance Strategies"><!-- Legacy link --></a>
<h2 id="inheritanceStrategies">7.5.2.3 Inheritance Strategies</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/inheritanceStrategies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default GORM classes use <code>table-per-hierarchy</code> inheritance mapping. This has the disadvantage that columns cannot have a <code>NOT-NULL</code> constraint applied to them at the database level. If you would prefer to use a <code>table-per-subclass</code> inheritance strategy you can do so as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Payment</span> {
    <span class="predefined-type">Integer</span> amount

    <span class="directive">static</span> mapping = {
        tablePerHierarchy <span class="predefined-constant">false</span>
    }
}

<span class="type">class</span> <span class="class">CreditCardPayment</span> <span class="directive">extends</span> Payment {
    <span class="predefined-type">String</span> cardNumber
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping of the root <code>Payment</code> class specifies that it will not be using <code>table-per-hierarchy</code> mapping for all child classes.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use a <code>table-per-concrete-class</code> inheritance strategy where each concrete class will have its own table with columns for all properties of the class, including inherited properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Payment</span> {
    <span class="predefined-type">Integer</span> amount

    <span class="directive">static</span> mapping = {
        tablePerConcreteClass <span class="predefined-constant">true</span>
    }
}

<span class="type">class</span> <span class="class">CreditCardPayment</span> <span class="directive">extends</span> Payment {
    <span class="predefined-type">String</span> cardNumber
}</code></pre>
</div>
</div>

<a name="5.5.2.4 Custom Database Identity"><!-- Legacy link --></a>
<h2 id="identity">7.5.2.4 Custom Database Identity</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/identity.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can customize how GORM generates identifiers for the database using the DSL. By default GORM relies on the native database mechanism for generating ids. This is by far the best approach, but there are still many schemas that have different approaches to identity.</p>
</div>
<div class="paragraph">
<p>To deal with this Hibernate defines the concept of an id generator. You can customize the id generator and the column it maps to as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        version <span class="predefined-constant">false</span>
        id <span class="key">generator</span>: <span class="string"><span class="delimiter">'</span><span class="content">hilo</span><span class="delimiter">'</span></span>,
           <span class="key">params</span>: [<span class="key">table</span>: <span class="string"><span class="delimiter">'</span><span class="content">hi_value</span><span class="delimiter">'</span></span>,
                    <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">next_value</span><span class="delimiter">'</span></span>,
                    <span class="key">max_lo</span>: <span class="integer">100</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we&#8217;re using one of Hibernate&#8217;s built in 'hilo' generators that uses a separate table to generate ids.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information on the different Hibernate generators refer to the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-declaration-id-generator">Hibernate reference documentation</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although you don&#8217;t typically specify the <code>id</code> field (Grails adds it for you) you can still configure its mapping like the other properties. For example to customise the column for the id property you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        version <span class="predefined-constant">false</span>
        id <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">person_id</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>

<a name="5.5.2.5 Composite Primary Keys"><!-- Legacy link --></a>
<h2 id="compositePrimaryKeys">7.5.2.5 Composite Primary Keys</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/compositePrimaryKeys.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>GORM supports the concept of composite identifiers (identifiers composed from 2 or more properties). It is not an approach we recommend, but is available to you if you need it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.lang.builder.HashCodeBuilder</span>

<span class="type">class</span> <span class="class">Person</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName

    <span class="type">boolean</span> equals(other) {
        <span class="keyword">if</span> (!(other <span class="keyword">instanceof</span> Person)) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>
        }

        other.firstName == firstName &amp;&amp; other.lastName == lastName
    }

    <span class="type">int</span> hashCode() {
        <span class="keyword">def</span> builder = <span class="keyword">new</span> HashCodeBuilder()
        builder.append firstName
        builder.append lastName
        builder.toHashCode()
    }

    <span class="directive">static</span> mapping = {
        id <span class="key">composite</span>: [<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above will create a composite id of the <code>firstName</code> and <code>lastName</code> properties of the Person class. To retrieve an instance by id you use a prototype of the object itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="keyword">new</span> Person(<span class="key">firstName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Flintstone</span><span class="delimiter">&quot;</span></span>))
println p.firstName</code></pre>
</div>
</div>
<div class="paragraph">
<p>Domain classes mapped with composite primary keys must implement the <code>Serializable</code> interface and override the <code>equals</code> and <code>hashCode</code> methods, using the properties in the composite key for the calculations. The example above uses a <code>HashCodeBuilder</code> for convenience but it&#8217;s fine to implement it yourself.</p>
</div>
<div class="paragraph">
<p>Another important consideration when using composite primary keys is associations. If for example you have a many-to-one association where the foreign keys are stored in the associated table then 2 columns will be present in the associated table.</p>
</div>
<div class="paragraph">
<p>For example consider the following domain class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {
    Person person
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the <code>address</code> table will have an additional two columns called <code>person_first_name</code> and <code>person_last_name</code>. If you wish the change the mapping of these columns then you can do so using the following technique:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {
    Person person
    <span class="directive">static</span> mapping = {
        columns {
                    person {
                column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FirstName</span><span class="delimiter">&quot;</span></span>
                column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">LastName</span><span class="delimiter">&quot;</span></span>
                        }
        }
    }
}</code></pre>
</div>
</div>

<a name="5.5.2.6 Database Indices"><!-- Legacy link --></a>
<h2 id="databaseIndices">7.5.2.6 Database Indices</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/databaseIndices.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get the best performance out of your queries it is often necessary to tailor the table index definitions. How you tailor them is domain specific and a matter of monitoring usage patterns of your queries. With GORM&#8217;s DSL you can specify which columns are used in which indexes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> address
    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        version <span class="predefined-constant">false</span>
        id <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">person_id</span><span class="delimiter">'</span></span>
        firstName <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">First_Name</span><span class="delimiter">'</span></span>, <span class="key">index</span>: <span class="string"><span class="delimiter">'</span><span class="content">Name_Idx</span><span class="delimiter">'</span></span>
        address <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">Address</span><span class="delimiter">'</span></span>, <span class="key">index</span>: <span class="string"><span class="delimiter">'</span><span class="content">Name_Idx,Address_Index</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you cannot have any spaces in the value of the <code>index</code> attribute; in this example <code>index:'Name_Idx, Address_Index'</code> will cause an error.</p>
</div>

<a name="5.5.2.7 Optimistic Locking and Versioning"><!-- Legacy link --></a>
<h2 id="optimisticLockingAndVersioning">7.5.2.7 Optimistic Locking and Versioning</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/optimisticLockingAndVersioning.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As discussed in the section on <a href="#locking">Optimistic and Pessimistic Locking</a>, by default GORM uses optimistic locking and automatically injects a <code>version</code> property into every class which is in turn mapped to a <code>version</code> column at the database level.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re mapping to a legacy schema that doesn&#8217;t have version columns (or there&#8217;s some other reason why you don&#8217;t want/need this feature) you can disable this with the <code>version</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    ...
    static mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
        version <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you disable optimistic locking you are essentially on your own with regards to concurrent updates and are open to the risk of users losing data (due to data overriding) unless you use <a href="#locking">pessimistic locking</a>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_version_columns_types">Version columns types</h4>
<div class="paragraph">
<p>By default Grails maps the <code>version</code> property as a <code>Long</code> that gets incremented by one each time an instance is updated. But Hibernate also supports using a <code>Timestamp</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">java.sql.Timestamp</span>

<span class="type">class</span> <span class="class">Person</span> {

    ...
    Timestamp version

    <span class="directive">static</span> mapping = {
        table <span class="string"><span class="delimiter">'</span><span class="content">people</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s a slight risk that two updates occurring at nearly the same time on a fast server can end up with the same timestamp value but this risk is very low. One benefit of using a <code>Timestamp</code> instead of a <code>Long</code> is that you combine the optimistic locking and last-updated semantics into a single column.</p>
</div>
</div>

<a name="5.5.2.8 Eager and Lazy Fetching"><!-- Legacy link --></a>
<h2 id="fetchingDSL">7.5.2.8 Eager and Lazy Fetching</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/fetchingDSL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_lazy_collections">Lazy Collections</h4>
<div class="paragraph">
<p>As discussed in the section on <a href="#fetching">Eager and Lazy fetching</a>, GORM collections are lazily loaded by default but you can change this behaviour with the ORM DSL. There are several options available to you, but the most common ones are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lazy: false</p>
</li>
<li>
<p>fetch: 'join'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and they&#8217;re used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName
    Pet pet

    <span class="directive">static</span> hasMany = [<span class="key">addresses</span>: Address]

    <span class="directive">static</span> mapping = {
        addresses <span class="key">lazy</span>: <span class="predefined-constant">false</span>
        pet <span class="key">fetch</span>: <span class="string"><span class="delimiter">'</span><span class="content">join</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> street
    <span class="predefined-type">String</span> postCode
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Pet</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first option, <code>lazy: false</code> , ensures that when a <code>Person</code> instance is loaded, its <code>addresses</code> collection is loaded at the same time with a second SELECT. The second option is basically the same, except the collection is loaded with a JOIN rather than another SELECT. Typically you want to reduce the number of queries, so <code>fetch: 'join'</code> is the more appropriate option. On the other hand, it could feasibly be the more expensive approach if your domain model and data result in more and larger results than would otherwise be necessary.</p>
</div>
<div class="paragraph">
<p>For more advanced users, the other settings available are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>batchSize: N</p>
</li>
<li>
<p>lazy: false, batchSize: N</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>where N is an integer. These let you fetch results in batches, with one query per batch. As a simple example, consider this mapping for <code>Person</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName
    Pet pet

    <span class="directive">static</span> mapping = {
        pet <span class="key">batchSize</span>: <span class="integer">5</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a query returns multiple <code>Person</code> instances, then when we access the first <code>pet</code> property, Hibernate will fetch that <code>Pet</code> plus the four next ones. You can get the same behaviour with eager loading by combining <code>batchSize</code> with the <code>lazy: false</code> option. You can find out more about these options in the <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/performance.html#performance-fetching">Hibernate user guide</a> and this <a href="http://community.jboss.org/wiki/AShortPrimerOnFetchingStrategies">primer on fetching strategies</a>. Note that ORM DSL does not currently support the "subselect" fetching strategy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lazy_single_ended_associations">Lazy Single-Ended Associations</h4>
<div class="paragraph">
<p>In GORM, one-to-one and many-to-one associations are by default lazy. Non-lazy single ended associations can be problematic when you load many entities because each non-lazy association will result in an extra SELECT statement. If the associated entities also have non-lazy associations, the number of queries grows significantly!</p>
</div>
<div class="paragraph">
<p>Use the same technique as for lazy collections to make a one-to-one or many-to-one association non-lazy/eager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {

    <span class="predefined-type">String</span> street
    <span class="predefined-type">String</span> postCode

    <span class="directive">static</span> belongsTo = [<span class="key">person</span>: Person]

    <span class="directive">static</span> mapping = {
        person <span class="key">lazy</span>: <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we configure GORM to load the associated <code>Person</code> instance (through the <code>person</code> property) whenever an <code>Address</code> is loaded.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lazy_single_ended_associations_and_proxies">Lazy Single-Ended Associations and Proxies</h4>
<div class="paragraph">
<p>Hibernate uses runtime-generated proxies to facilitate single-ended lazy associations; Hibernate dynamically subclasses the entity class to create the proxy.</p>
</div>
<div class="paragraph">
<p>Consider the previous example but with a lazily-loaded <code>person</code> association: Hibernate will set the <code>person</code> property to a proxy that is a subclass of <code>Person</code>. When you call any of the getters (except for the <code>id</code> property) or setters on that proxy, Hibernate will load the entity from the database.</p>
</div>
<div class="paragraph">
<p>Unfortunately this technique can produce surprising results. Consider the following example classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Pet</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Dog</span> <span class="directive">extends</span> Pet {
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Pet pet
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and assume that we have a single <code>Person</code> instance with a <code>Dog</code> as the <code>pet</code>. The following code will work as you would expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> person = Person.get(<span class="integer">1</span>)
<span class="keyword">assert</span> person.pet <span class="keyword">instanceof</span> Dog
<span class="keyword">assert</span> Pet.get(person.petId) <span class="keyword">instanceof</span> Dog</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this won&#8217;t:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> person = Person.get(<span class="integer">1</span>)
<span class="keyword">assert</span> person.pet <span class="keyword">instanceof</span> Dog
<span class="keyword">assert</span> Pet.list()[<span class="integer">0</span>] <span class="keyword">instanceof</span> Dog</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second assertion fails, and to add to the confusion, this will work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">assert</span> Pet.list()[<span class="integer">0</span>] <span class="keyword">instanceof</span> Dog</code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s going on here? It&#8217;s down to a combination of how proxies work and the guarantees that the Hibernate session makes. When you load the <code>Person</code> instance, Hibernate creates a proxy for its <code>pet</code> relation and attaches it to the session. Once that happens, whenever you retrieve that <code>Pet</code> instance with a query, a <code>get()</code>, or the <code>pet</code> relation <em>within the same session</em> , Hibernate gives you the proxy.</p>
</div>
<div class="paragraph">
<p>Fortunately for us, GORM automatically unwraps the proxy when you use <code>get()</code> and <code>findBy*()</code>, or when you directly access the relation. That means you don&#8217;t have to worry at all about proxies in the majority of cases. But GORM doesn&#8217;t do that for objects returned with a query that returns a list, such as <code>list()</code> and <code>findAllBy\*()</code>. However, if Hibernate hasn&#8217;t attached the proxy to the session, those queries will return the real instances - hence why the last example works.</p>
</div>
<div class="paragraph">
<p>You can protect yourself to a degree from this problem by using the <code>instanceOf</code> method by GORM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> person = Person.get(<span class="integer">1</span>)
<span class="keyword">assert</span> Pet.list()[<span class="integer">0</span>].instanceOf(Dog)</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, it won&#8217;t help here if casting is involved. For example, the following code will throw a <code>ClassCastException</code> because the first pet in the list is a proxy instance with a class that is neither <code>Dog</code> nor a sub-class of <code>Dog</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> person = Person.get(<span class="integer">1</span>)
Dog pet = Pet.list()[<span class="integer">0</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, it&#8217;s best not to use static types in this situation. If you use an untyped variable for the pet instead, you can access any <code>Dog</code> properties or methods on the instance without any problems.</p>
</div>
<div class="paragraph">
<p>These days it&#8217;s rare that you will come across this issue, but it&#8217;s best to be aware of it just in case. At least you will know why such an error occurs and be able to work around it.</p>
</div>
</div>

<a name="5.5.2.9 Custom Cascade Behaviour"><!-- Legacy link --></a>
<h2 id="customCascadeBehaviour">7.5.2.9 Custom Cascade Behaviour</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/customCascadeBehaviour.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As described in the section on <a href="#cascades">cascading updates</a>, the primary mechanism to control the way updates and deletes cascade from one association to another is the static <a href="../ref/Domain%20Classes/belongsTo.html">belongsTo</a> property.</p>
</div>
<div class="paragraph">
<p>However, the ORM DSL gives you complete access to Hibernate&#8217;s <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/objectstate.html#objectstate-transitive">transitive persistence</a> capabilities using the <code>cascade</code> attribute.</p>
</div>
<div class="paragraph">
<p>Valid settings for the cascade attribute include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>merge</code> - merges the state of a detached association</p>
</li>
<li>
<p><code>save-update</code> - cascades only saves and updates to an association</p>
</li>
<li>
<p><code>delete</code> - cascades only deletes to an association</p>
</li>
<li>
<p><code>lock</code> - useful if a pessimistic lock should be cascaded to its associations</p>
</li>
<li>
<p><code>refresh</code> - cascades refreshes to an association</p>
</li>
<li>
<p><code>evict</code> - cascades evictions (equivalent to <code>discard()</code> in GORM) to associations if set</p>
</li>
<li>
<p><code>all</code> - cascade <em>all</em> operations to associations</p>
</li>
<li>
<p><code>all-delete-orphan</code> - Applies only to one-to-many associations and indicates that when a child is removed from an association then it should be automatically deleted. Children are also deleted when the parent is.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is advisable to read the section in the Hibernate documentation on <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/objectstate.html#objectstate-transitive">transitive persistence</a> to obtain a better understanding of the different cascade styles and recommendations for their usage
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To specify the cascade attribute simply define one or more (comma-separated) of the aforementioned settings as its value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="predefined-type">String</span> firstName

    <span class="directive">static</span> hasMany = [<span class="key">addresses</span>: Address]

    <span class="directive">static</span> mapping = {
        addresses <span class="key">cascade</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">all-delete-orphan</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> street
    <span class="predefined-type">String</span> postCode
}</code></pre>
</div>
</div>

<a name="5.5.2.10 Custom Hibernate Types"><!-- Legacy link --></a>
<h2 id="customHibernateTypes">7.5.2.10 Custom Hibernate Types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/customHibernateTypes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You saw in an earlier section that you can use composition (with the <code>embedded</code> property) to break a table into multiple objects. You can achieve a similar effect with Hibernate&#8217;s custom user types. These are not domain classes themselves, but plain Java or Groovy classes. Each of these types also has a corresponding "meta-type" class that implements <a href="http://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/usertype/UserType.html">org.hibernate.usertype.UserType</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/mapping.html#mapping-types-custom">Hibernate reference manual</a> has some information on custom types, but here we will focus on how to map them in Grails. Let&#8217;s start by taking a look at a simple domain class that uses an old-fashioned (pre-Java 1.5) type-safe enum class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {

    <span class="predefined-type">String</span> title
    <span class="predefined-type">String</span> author
    Rating rating

    <span class="directive">static</span> mapping = {
        rating <span class="key">type</span>: RatingUserType
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All we have done is declare the <code>rating</code> field the enum type and set the property&#8217;s type in the custom mapping to the corresponding <code>UserType</code> implementation. That&#8217;s all you have to do to start using your custom type. If you want, you can also use the other column settings such as "column" to change the column name and "index" to add it to an index.</p>
</div>
<div class="paragraph">
<p>Custom types aren&#8217;t limited to just a single column - they can be mapped to as many columns as you want. In such cases you explicitly define in the mapping what columns to use, since Hibernate can only use the property name for a single column. Fortunately, Grails lets you map multiple columns to a property using this syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {

    <span class="predefined-type">String</span> title
    <span class="predefined-type">Name</span> author
    Rating rating

    <span class="directive">static</span> mapping = {
        author <span class="key">type</span>: NameUserType, {
            column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>
            column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">last_name</span><span class="delimiter">&quot;</span></span>
        }
        rating <span class="key">type</span>: RatingUserType
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example will create "first_name" and "last_name" columns for the <code>author</code> property. You&#8217;ll be pleased to know that you can also use some of the normal column/property mapping attributes in the column definitions. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>, <span class="key">index</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my_idx</span><span class="delimiter">&quot;</span></span>, <span class="key">unique</span>: <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The column definitions do <em>not</em> support the following attributes: <code>type</code>, <code>cascade</code>, <code>lazy</code>, <code>cache</code>, and <code>joinTable</code>.</p>
</div>
<div class="paragraph">
<p>One thing to bear in mind with custom types is that they define the <em>SQL types</em> for the corresponding database columns. That helps take the burden of configuring them yourself, but what happens if you have a legacy database that uses a different SQL type for one of the columns? In that case, override the column&#8217;s SQL type using the <code>sqlType</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {

    <span class="predefined-type">String</span> title
    <span class="predefined-type">Name</span> author
    Rating rating

    <span class="directive">static</span> mapping = {
        author <span class="key">type</span>: NameUserType, {
            column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">first_name</span><span class="delimiter">&quot;</span></span>, <span class="key">sqlType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>
            column <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">last_name</span><span class="delimiter">&quot;</span></span>, <span class="key">sqlType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>
        }
        rating <span class="key">type</span>: RatingUserType, <span class="key">sqlType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mind you, the SQL type you specify needs to still work with the custom type. So overriding a default of "varchar" with "text" is fine, but overriding "text" with "yes_no" isn&#8217;t going to work.</p>
</div>

<a name="5.5.2.11 Derived Properties"><!-- Legacy link --></a>
<h2 id="derivedProperties">7.5.2.11 Derived Properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/derivedProperties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A derived property is one that takes its value from a SQL expression, often but not necessarily based on the value of one or more other persistent properties.  Consider a Product class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Product</span> {
    <span class="predefined-type">Float</span> price
    <span class="predefined-type">Float</span> taxRate
    <span class="predefined-type">Float</span> tax
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>tax</code> property is derived based on the value of <code>price</code> and <code>taxRate</code> properties then is probably no need to persist the <code>tax</code> property.  The SQL used to derive the value of a derived property may be expressed in the ORM DSL like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Product</span> {
    <span class="predefined-type">Float</span> price
    <span class="predefined-type">Float</span> taxRate
    <span class="predefined-type">Float</span> tax

    <span class="directive">static</span> mapping = {
        tax <span class="key">formula</span>: <span class="string"><span class="delimiter">'</span><span class="content">PRICE * TAX_RATE</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the formula expressed in the ORM DSL is SQL so references to other properties should relate to the persistence model not the object model, which is why the example refers to <code>PRICE</code> and <code>TAX_RATE</code> instead of <code>price</code> and <code>taxRate</code>.</p>
</div>
<div class="paragraph">
<p>With that in place, when a Product is retrieved with something like <code>Product.get(42)</code>, the SQL that is generated to support that will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">select
    product0_.id <span class="keyword">as</span> id1_0_,
    product0_.version <span class="keyword">as</span> version1_0_,
    product0_.price <span class="keyword">as</span> price1_0_,
    product0_.tax_rate <span class="keyword">as</span> tax4_1_0_,
    product0_.PRICE * product0_.TAX_RATE <span class="keyword">as</span> formula1_0_
from
    product product0_
where
    product0_.id=?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the <code>tax</code> property is derived at runtime and not stored in the database it might seem that the same effect could be achieved by adding a method like <code>getTax()</code> to the <code>Product</code> class that simply returns the product of the <code>taxRate</code> and <code>price</code> properties.  With an approach like that you would give up the ability query the database based on the value of the <code>tax</code> property.  Using a derived property allows exactly that.  To retrieve all <code>Product</code> objects that have a <code>tax</code> value greater than 21.12 you could execute a query like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Product.findAllByTaxGreaterThan(<span class="float">21.12</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Derived properties may be referenced in the Criteria API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Product.withCriteria {
    gt <span class="string"><span class="delimiter">'</span><span class="content">tax</span><span class="delimiter">'</span></span>, <span class="float">21.12f</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SQL that is generated to support either of those would look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">select
    this_.id <span class="keyword">as</span> id1_0_,
    this_.version <span class="keyword">as</span> version1_0_,
    this_.price <span class="keyword">as</span> price1_0_,
    this_.tax_rate <span class="keyword">as</span> tax4_1_0_,
    this_.PRICE * this_.TAX_RATE <span class="keyword">as</span> formula1_0_
from
    product this_
where
    this_.PRICE * this_.TAX_RATE&gt;?</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because the value of a derived property is generated in the database and depends on the execution of SQL code, derived properties may not have GORM constraints applied to them.  If constraints are specified for a derived property, they will be ignored.
</td>
</tr>
</table>
</div>

<a name="5.5.2.12 Custom Naming Strategy"><!-- Legacy link --></a>
<h2 id="customNamingStrategy">7.5.2.12 Custom Naming Strategy</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/ormdsl/customNamingStrategy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default Grails uses Hibernate&#8217;s <code>ImprovedNamingStrategy</code> to convert domain class Class and field names to SQL table and column names by converting from camel-cased Strings to ones that use underscores as word separators. You can customize these on a per-class basis in the <code>mapping</code> closure but if there&#8217;s a consistent pattern you can specify a different <code>NamingStrategy</code> class to use.</p>
</div>
<div class="paragraph">
<p>Configure the class name to be used in <code>grails-app/conf/application.groovy</code> in the <code>hibernate</code> section, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource {
    pooled = <span class="predefined-constant">true</span>
    dbCreate = <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>
    ...
}

hibernate {
    cache.use_second_level_cache = <span class="predefined-constant">true</span>
    ...
    naming_strategy = com.myco.myproj.CustomNamingStrategy
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify the name of the class and it will be loaded for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">hibernate {
    ...
    naming_strategy = <span class="string"><span class="delimiter">'</span><span class="content">com.myco.myproj.CustomNamingStrategy</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A third option is to provide an instance if there is some configuration required beyond calling the default constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">hibernate {
    ...
    def strategy = <span class="keyword">new</span> com.myco.myproj.CustomNamingStrategy()
    <span class="comment">// configure as needed</span>
    naming_strategy = strategy
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use an existing class or write your own, for example one that prefixes table names and column names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.myco.myproj

<span class="keyword">import</span> <span class="include">org.hibernate.cfg.ImprovedNamingStrategy</span>
<span class="keyword">import</span> <span class="include">org.hibernate.util.StringHelper</span>

<span class="type">class</span> <span class="class">CustomNamingStrategy</span> <span class="directive">extends</span> ImprovedNamingStrategy {

    <span class="predefined-type">String</span> classToTableName(<span class="predefined-type">String</span> className) {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">table_</span><span class="delimiter">&quot;</span></span> + StringHelper.unqualify(className)
    }

    <span class="predefined-type">String</span> propertyToColumnName(<span class="predefined-type">String</span> propertyName) {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">col_</span><span class="delimiter">&quot;</span></span> + StringHelper.unqualify(propertyName)
    }
}</code></pre>
</div>
</div>

<a name="5.5.3 Default Sort Order"><!-- Legacy link --></a>
<h2 id="defaultSortOrder">7.5.3 Default Sort Order</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/advancedGORMFeatures/defaultSortOrder.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can sort objects using query arguments such as those found in the <a href="../ref/Domain%20Classes/list.html">list</a> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> airports = Airport.list(<span class="key">sort</span>:<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, you can also declare the default sort order for a collection in the mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    ...
    static mapping = {
        sort <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above means that all collections of <code>Airport</code> instances will by default be sorted by the airport name. If you also want to change the sort <em>order</em>, use this syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    ...
    static mapping = {
        sort <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">desc</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, you can configure sorting at the association level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Airport</span> {
    ...
    static hasMany = [<span class="key">flights</span>: Flight]

    <span class="directive">static</span> mapping = {
        flights <span class="key">sort</span>: <span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>, <span class="key">order</span>: <span class="string"><span class="delimiter">'</span><span class="content">desc</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>flights</code> collection will always be sorted in descending order of flight number.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
These mappings will not work for default unidirectional one-to-many or many-to-many relationships because they involve a join table. See <a href="https://github.com/grails/grails-core/issues/3305">this issue</a> for more details. Consider using a <code>SortedSet</code> or queries with sort parameters to fetch the data you need.
</td>
</tr>
</table>
</div>

<a name="5.6 Programmatic Transactions"><!-- Legacy link --></a>
<h2 id="programmaticTransactions">7.6 Programmatic Transactions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/programmaticTransactions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails is built on Spring and uses Spring&#8217;s Transaction abstraction for dealing with programmatic transactions. However, GORM classes have been enhanced to make this simpler with the <a href="../ref/Domain%20Classes/withTransaction.html">withTransaction</a> method. This method has a single parameter, a Closure, which has a single parameter which is a Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/transaction/TransactionStatus.html">TransactionStatus</a> instance.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of using <code>withTransaction</code> in a controller methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">transferFunds</span>() {
    Account.withTransaction { status -&gt;
        <span class="keyword">def</span> source = Account.get(params.from)
        <span class="keyword">def</span> dest = Account.get(params.to)

        <span class="keyword">def</span> amount = params.amount.toInteger()
        <span class="keyword">if</span> (source.active) {
            <span class="keyword">if</span> (dest.active) {
                source.balance -= amount
                dest.amount += amount
            }
            <span class="keyword">else</span> {
                status.setRollbackOnly()
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we rollback the transaction if the destination account is not active. Also, if an unchecked <code>Exception</code> or <code>Error</code> (but not a checked <code>Exception</code>, even though Groovy doesn&#8217;t require that you catch checked exceptions) is thrown during the process the transaction will automatically be rolled back.</p>
</div>
<div class="paragraph">
<p>You can also use "save points" to rollback a transaction to a particular point in time if you don&#8217;t want to rollback the entire transaction. This can be achieved through the use of Spring&#8217;s <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/transaction/SavepointManager.html">SavePointManager</a> interface.</p>
</div>
<div class="paragraph">
<p>The <code>withTransaction</code> method deals with the begin/commit/rollback logic for you within the scope of the block.</p>
</div>

<a name="5.7 GORM and Constraints"><!-- Legacy link --></a>
<h2 id="gormConstraints">7.7 GORM and Constraints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/3.1.x/src/en/guide/GORM/gormConstraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Although constraints are covered in the <a href="validation.html#constraints">Validation</a> section, it is important to mention them here as some of the constraints can affect the way in which the database schema is generated.</p>
</div>
<div class="paragraph">
<p>Where feasible, Grails uses a domain class&#8217;s constraints to influence the database columns generated for the corresponding domain class properties.</p>
</div>
<div class="paragraph">
<p>Consider the following example.  Suppose we have a domain model with the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> name
<span class="predefined-type">String</span> description</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, in MySQL, Grails would define these columns as</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">varchar(255)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">varchar(255)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>But perhaps the business rules for this domain class state that a description can be up to 1000 characters in length.  If that were the case, we would likely define the column as follows <em>if</em> we were creating the table with an SQL script.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TEXT</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Chances are we would also want to have some application-based validation to make sure we don&#8217;t exceed that 1000 character limit <em>before</em> we persist any records.  In Grails, we achieve this validation with <a href="validation.html#constraints">Constraints</a>.  We would add the following constraint declaration to the domain class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
    description <span class="key">maxSize</span>: <span class="integer">1000</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This constraint would provide both the application-based validation we want and it would also cause the schema to be generated as shown above.  Below is a description of the other constraints that influence schema generation.</p>
</div>
<div class="sect3">
<h4 id="_constraints_affecting_string_properties">Constraints Affecting String Properties</h4>
<div class="ulist">
<ul>
<li>
<p><a href="../ref/Constraints/inList.html">inList</a></p>
</li>
<li>
<p><a href="../ref/Constraints/maxSize.html">maxSize</a></p>
</li>
<li>
<p><a href="../ref/Constraints/size.html">size</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If either the <code>maxSize</code> or the <code>size</code> constraint is defined, Grails sets the maximum column length based on the constraint value.</p>
</div>
<div class="paragraph">
<p>In general, it&#8217;s not advisable to use both constraints on the same domain class property.  However, if both the <code>maxSize</code> constraint and the <code>size</code> constraint are defined, then Grails sets the column length to the minimum of the <code>maxSize</code> constraint and the upper bound of the size constraint.  (Grails uses the minimum of the two, because any length that exceeds that minimum will result in a validation error.)</p>
</div>
<div class="paragraph">
<p>If the <code>inList</code> constraint is defined (and the <code>maxSize</code> and the <code>size</code> constraints are not defined), then Grails sets the maximum column length based on the length of the longest string in the list of valid values.  For example, given a list including values "Java", "Groovy", and "C++", Grails would set the column length to 6 (i.e., the number of characters in the string "Groovy").</p>
</div>
</div>
<div class="sect3">
<h4 id="_constraints_affecting_numeric_properties">Constraints Affecting Numeric Properties</h4>
<div class="ulist">
<ul>
<li>
<p><a href="../ref/Constraints/min.html">min</a></p>
</li>
<li>
<p><a href="../ref/Constraints/max.html">max</a></p>
</li>
<li>
<p><a href="../ref/Constraints/range.html">range</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>max</code>, <code>min</code>, or <code>range</code> constraint is defined, Grails attempts to set the column precision based on the constraint value.  (The success of this attempted influence is largely dependent on how Hibernate interacts with the underlying DBMS.)</p>
</div>
<div class="paragraph">
<p>In general, it&#8217;s not advisable to combine the pair <code>min</code>/<code>max</code> and <code>range</code> constraints together on the same domain class property.  However, if both of these constraints is defined, then Grails uses the minimum precision value from the constraints.  (Grails uses the minimum of the two, because any length that exceeds that minimum precision will result in a validation error.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../ref/Constraints/scale.html">scale</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the scale constraint is defined, then Grails attempts to set the column <a href="../ref/Constraints/scale.html">scale</a> based on the constraint value.  This rule only applies to floating point numbers (i.e., <code>java.lang.Float</code>, <code>java.Lang.Double</code>, <code>java.lang.BigDecimal</code>, or subclasses of <code>java.lang.BigDecimal</code>). The success of this attempted influence is largely dependent on how Hibernate interacts with the underlying DBMS.</p>
</div>
<div class="paragraph">
<p>The constraints define the minimum/maximum numeric values, and Grails derives the maximum number of digits for use in the precision. Keep in mind that specifying only one of <code>min</code>/<code>max</code> constraints will not affect schema generation (since there could be large negative value of property with max:100, for example), unless the specified constraint value requires more digits than default Hibernate column precision is (19 at the moment). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">someFloatValue <span class="key">max</span>: <span class="integer">1000000</span>, <span class="key">scale</span>: <span class="integer">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>would yield:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">someFloatValue DECIMAL(<span class="integer">19</span>, <span class="integer">3</span>) <span class="comment">// precision is default</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>but</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">someFloatValue <span class="key">max</span>: <span class="integer">12345678901234567890</span>, <span class="key">scale</span>: <span class="integer">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>would yield:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">someFloatValue DECIMAL(<span class="integer">25</span>, <span class="integer">5</span>) <span class="comment">// precision = digits in max + scale</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">someFloatValue <span class="key">max</span>: <span class="integer">100</span>, <span class="key">min</span>: -<span class="integer">100000</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>would yield:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">someFloatValue DECIMAL(<span class="integer">8</span>, <span class="integer">2</span>) <span class="comment">// precision = digits in min + default scale</span></code></pre>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/profiles.html">&lt;&lt; <strong>6</strong><span>Application Profiles</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/theWebLayer.html"><strong>8</strong><span>The Web Layer</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Command%20Line/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/bug-report.html">bug-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/clean.html">clean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/compile.html">compile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/console.html">console</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-app.html">create-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-command.html">create-command</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-controller.html">create-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-functional-test.html">create-functional-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-hibernate-cfg-xml.html">create-hibernate-cfg-xml</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-integration-test.html">create-integration-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-interceptor.html">create-interceptor</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-plugin.html">create-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-profile.html">create-profile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-script.html">create-script</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-service.html">create-service</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-taglib.html">create-taglib</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/create-unit-test.html">create-unit-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/dependency-report.html">dependency-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/docs.html">docs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/generate-all.html">generate-all</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/generate-controller.html">generate-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/generate-views.html">generate-views</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/help.html">help</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/install-templates.html">install-templates</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/list-plugins.html">list-plugins</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/list-profiles.html">list-profiles</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/package-plugin.html">package-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/package.html">package</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/plugin-info.html">plugin-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/profile-info.html">profile-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/run-app.html">run-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/schema-export.html">schema-export</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/shell.html">shell</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/stats.html">stats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/stop-app.html">stop-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/test-app.html">test-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Command%20Line/war.html">war</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Constraints</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Constraints/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Constraints/attributes.html">attributes</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/bindable.html">bindable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/blank.html">blank</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/creditCard.html">creditCard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/email.html">email</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/inList.html">inList</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/matches.html">matches</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/max.html">max</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/maxSize.html">maxSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/min.html">min</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/minSize.html">minSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/notEqual.html">notEqual</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/nullable.html">nullable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/range.html">range</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/scale.html">scale</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/size.html">size</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/unique.html">unique</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/url.html">url</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/validator.html">validator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Constraints/widget.html">widget</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controllers</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Controllers/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Controllers/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/allowedMethods.html">allowedMethods</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/bindData.html">bindData</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/chain.html">chain</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/defaultAction.html">defaultAction</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/forward.html">forward</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/grailsApplication.html">grailsApplication</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/namespace.html">namespace</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/redirect.html">redirect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/respond.html">respond</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/responseFormats.html">responseFormats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/session.html">session</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/withForm.html">withForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Controllers/withFormat.html">withFormat</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Database Mapping</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Database%20Mapping/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/autoImport.html">autoImport</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/autoTimestamp.html">autoTimestamp</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/batchSize.html">batchSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/cache.html">cache</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/cascade.html">cascade</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/column.html">column</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/comment.html">comment</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/discriminator.html">discriminator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/dynamicInsert.html">dynamicInsert</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/dynamicUpdate.html">dynamicUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/fetch.html">fetch</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/id.html">id</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/ignoreNotFound.html">ignoreNotFound</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/indexColumn.html">indexColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/insertable.html">insertable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/joinTable.html">joinTable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/lazy.html">lazy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/order.html">order</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/sort.html">sort</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/table.html">table</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/type.html">type</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/updateable.html">updateable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Database%20Mapping/version.html">version</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Domain%20Classes/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/addTo.html">addTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/attach.html">attach</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/belongsTo.html">belongsTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/clearErrors.html">clearErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/constraints.html">constraints</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/count.html">count</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/countBy.html">countBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/createCriteria.html">createCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/delete.html">delete</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/discard.html">discard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/embedded.html">embedded</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/executeQuery.html">executeQuery</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/exists.html">exists</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/fetchMode.html">fetchMode</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/find.html">find</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findAllBy.html">findAllBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findAllWhere.html">findAllWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findBy.html">findBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findOrCreateBy.html">findOrCreateBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findOrCreateWhere.html">findOrCreateWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findOrSaveBy.html">findOrSaveBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findOrSaveWhere.html">findOrSaveWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/findWhere.html">findWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/first.html">first</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/get.html">get</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/getAll.html">getAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/hasMany.html">hasMany</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/hasOne.html">hasOne</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/ident.html">ident</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/instanceOf.html">instanceOf</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/isAttached.html">isAttached</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/isDirty.html">isDirty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/last.html">last</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/list.html">list</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/listOrderBy.html">listOrderBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/load.html">load</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/lock.html">lock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/mapWith.html">mapWith</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/mappedBy.html">mappedBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/mapping.html">mapping</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/merge.html">merge</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/namedQueries.html">namedQueries</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/properties.html">properties</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/read.html">read</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/refresh.html">refresh</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/removeFrom.html">removeFrom</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/save.html">save</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/transients.html">transients</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/validate.html">validate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/where.html">where</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/whereAny.html">whereAny</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/withCriteria.html">withCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/withNewSession.html">withNewSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/withSession.html">withSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Domain%20Classes/withTransaction.html">withTransaction</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plug-ins</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Plug-ins/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/URL%20mappings.html">URL mappings</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/codecs.html">codecs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/controllers.html">controllers</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/core.html">core</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/dataSource.html">dataSource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/domainClasses.html">domainClasses</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/hibernate.html">hibernate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/i18n.html">i18n</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/logging.html">logging</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/scaffolding.html">scaffolding</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/services.html">services</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Plug-ins/servlets.html">servlets</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Services</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Services/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Services/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Services/transactional.html">transactional</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Servlet API</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Servlet%20API/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Servlet%20API/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Servlet%20API/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Servlet%20API/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tag Libraries</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/pageScope.html">pageScope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tag%20Libraries/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Tags/actionSubmit.html">actionSubmit</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/actionSubmitImage.html">actionSubmitImage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/applyLayout.html">applyLayout</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/checkBox.html">checkBox</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/collect.html">collect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/cookie.html">cookie</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/country.html">country</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/countrySelect.html">countrySelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/createLink.html">createLink</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/createLinkTo.html">createLinkTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/currencySelect.html">currencySelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/datePicker.html">datePicker</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/each.html">each</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/eachError.html">eachError</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/else.html">else</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/elseif.html">elseif</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/external.html">external</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/field.html">field</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/fieldError.html">fieldError</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/fieldValue.html">fieldValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/form.html">form</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/formatBoolean.html">formatBoolean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/formatDate.html">formatDate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/formatNumber.html">formatNumber</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/grep.html">grep</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/header.html">header</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/hiddenField.html">hiddenField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/if.html">if</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/img.html">img</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/include.html">include</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/isAvailable.html">isAvailable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/isNotAvailable.html">isNotAvailable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/javascript.html">javascript</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/join.html">join</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/layoutBody.html">layoutBody</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/layoutHead.html">layoutHead</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/layoutTitle.html">layoutTitle</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/link.html">link</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/localeSelect.html">localeSelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/message.html">message</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/meta.html">meta</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/pageProperty.html">pageProperty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/paginate.html">paginate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/passwordField.html">passwordField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/radio.html">radio</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/radioGroup.html">radioGroup</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/renderErrors.html">renderErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/resource.html">resource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/select.html">select</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/set.html">set</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/sortableColumn.html">sortableColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/submitButton.html">submitButton</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/textArea.html">textArea</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/textField.html">textField</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/timeZoneSelect.html">timeZoneSelect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/unless.html">unless</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/uploadForm.html">uploadForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Tags/while.html">while</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
